"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[60183],{28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(96540);const r={},o=s.createContext(r);function i(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}},83691:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Tutorials/ppin_tool","title":"PKCS#11 - Provider Connection Setup","description":"11 Provider Connection Setup","source":"@site/pkcs/Tutorials/ppin_tool.md","sourceDirName":"Tutorials","slug":"/Tutorials/ppin_tool","permalink":"/pkcs/Tutorials/ppin_tool","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"frontMatter":{"title":"PKCS#11 - Provider Connection Setup","sidebar_label":"PKCS#11 Provider Connection Setup"},"sidebar":"tutorialSidebar","previous":{"title":"Setting up CloudHSM Access","permalink":"/pkcs/Tutorials/CloudHSM/cloud_hsm_setup"},"next":{"title":"Testing and Troubleshooting","permalink":"/pkcs/Tutorials/troubleshooting"}}');var r=t(74848),o=t(28453);const i={title:"PKCS#11 - Provider Connection Setup",sidebar_label:"PKCS#11 Provider Connection Setup"},a="PKCS#11 Provider Connection Setup",l={},c=[{value:"&quot;ppin&quot; Command Line Tool",id:"ppin-command-line-tool",level:2},{value:"Show Installed Provider Version",id:"show-installed-provider-version",level:2},{value:"Overview of Configured HSM Slots, Service Proxies and Status of their Credentials",id:"overview-of-configured-hsm-slots-service-proxies-and-status-of-their-credentials",level:2},{value:"Fetch Partition Log",id:"fetch-partition-log",level:2},{value:"Connection Test",id:"connection-test",level:2},{value:"FortiGate Secret String",id:"fortigate-secret-string",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"pkcs11-provider-connection-setup",children:"PKCS#11 Provider Connection Setup"})}),"\n",(0,r.jsx)(n.h2,{id:"ppin-command-line-tool",children:'"ppin" Command Line Tool'}),"\n",(0,r.jsxs)(n.p,{children:["The ppin",(0,r.jsx)(n.sup,{children:(0,r.jsx)(n.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})," command line tool allows"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["to manage the ",(0,r.jsx)(n.a,{href:"/pkcs/Installation/permanent_secret_management",children:"connection credentials"})," for secure\nHSM communication (including service proxies)"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["to show the installed ",(0,r.jsx)(n.a,{href:"#show-installed-provider-version",children:"provider version"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["to ",(0,r.jsx)(n.a,{href:"#fetch-partition-log",children:"fetch the partition log"})," from configured HSMs and\nrun connectivity tests"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Below is an overview of the different command parameters:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:"noinline",children:"********************\nPrimus Permanent PIN\n********************\nparameters:\n\t-c: optional path to the primus.cfg configuration file.\n\t-s: optional path to the .secrets.cfg file.\ncommands:\n\tppin -h: \tthis message.\n\tppin -v: \tPKCS#11 provider version.\n\tppin -l: \tlist all Primus HSM hosts.\n\tppin -a -e <user name> [<setup pwd> <pkcs11 pwd>]: \n \t\tadd permanent secret for user <user name>.\n\tppin -u -e <user name> [<setup pwd> <pkcs11 pwd>]: \n \t\tupdate permanent secret for user <user name>\n\tppin -r -e <user name>: \tremove permanent secret for user <user name>.\n\tppin -p -e <user name> [proxy pwd]: \tadd proxy password for user <user name>.\n\tppin -x -e <user name>: \tremove proxy password for user <user name>.\n \tppin --fetchlog --user <user name> --hsm <hsm or host name> [--reverse] \n \t     [--since YYYY-MM-DD] [--out <file>]: \n \t\tDump the HSM log to stdout or a file.\n \tppin {-t | --test} [--user <user name>] [--hsm <hsm or host name>] \n \t     [--slot <slot name>] [--slotid <slot ID>]:\n\t\tTest connectivity to all HSMs and partitions \n\t\tin the config file (performs a login).\n\t\tOptionally filter by HSM name, user name, \n\t\tslot name, slot ID.\n\tppin --fortinet --user <user> [<setup pwd> [<pkcs11 pwd>]] \n\t\t [--proxyuser <proxy user> [--proxypwd <proxy pwd>]]: \n\t\t encode secrets config for Fortinet product in base64\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The list of possible ",(0,r.jsx)(n.a,{href:"/pkcs/Tutorials/troubleshooting#error-codes",children:"ppin error codes"})," can be found in the testing\nand trouble shooting section."]}),"\n",(0,r.jsx)(n.h2,{id:"show-installed-provider-version",children:"Show Installed Provider Version"}),"\n",(0,r.jsx)(n.p,{children:"The following command lists the currently installed provider version:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ppin -v\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"Primus HSM PKCS#11 2.2.4\n"})}),"\n",(0,r.jsx)(n.h2,{id:"overview-of-configured-hsm-slots-service-proxies-and-status-of-their-credentials",children:"Overview of Configured HSM Slots, Service Proxies and Status of their Credentials"}),"\n",(0,r.jsx)(n.p,{children:"The following command lists the defined HSM slots and service proxies,\ntogether with their credential status. The example shows"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"two redundant HSM clusters (2 HSMs per Partition-1 and Partition-2),\nalready having fetched the permanent secret and"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"one redundant CloudHSM partition (CLOUDHSMPAR, Service User\n'eqabxrfnqqos'), not yet configured at all."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ppin -l\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"********************\nPrimus Permanent PIN\n********************\n[01] slot-id 0:    user 'Partition-1'   permanent secret: Configured\n[02] slot-id 1:    user 'Partition-2'   permanent secret: Configured\n[03] slot-id 5:    user 'CLOUDHSMPAR'  permanent secret: MISSING\n[04] slot-id 0:    user 'Partition-1'   permanent secret: Configured\n[05] slot-id 1:    user 'Partition-2'   permanent secret: Configured\n[06] slot-id 5:    user 'CLOUDHSMPAR'  permanent secret: MISSING\n[01] service/proxy user 'eqabxrfnqqos'  permanent secret: MISSING\n[02] service/proxy user 'eqabxrfnqqos'  permanent secret: MISSING\n"})}),"\n",(0,r.jsx)(n.h2,{id:"fetch-partition-log",children:"Fetch Partition Log"}),"\n",(0,r.jsx)(n.p,{children:"Get the HSM user log of a specific partition and HSM as configured in\nprimus.cfg configuration file since specified date:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ppin --fetchlog --user HSM_USERNAME --hsm hsm1 --since 2021-04-01\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"Dump log starting from 2021-04-01 00:00 UTC\nFetching log from HSM.\nNumber of slots: 1\n2021 Apr  1 09:31:28 UTC NUFENEN notice MSCNG Process: Login request: User: DEMO-TEST Client: SecurosysKspCfg@W10C-TESTCLIENT@192.168.76.76@00:0c:29:73:e6:7b with setup password over TCP connection 536870926 (IP 178.198.217.194:31550)\n2021 Apr  1 09:31:28 UTC NUFENEN info MSCNG Process: Login successful: User: DEMO-TEST Client: SecurosysKspCfg@W10C-TESTCLIENT@192.168.76.76@00:0c:29:73:e6:7b over TCP connection 0x2000000e (IP 178.198.217.194:31550)\n2021 Apr  1 09:31:29 UTC NUFENEN notice Crypto Process: Interaction: User: DEMO-TEST, Client: SecurosysKspCfg@W10C-TESTCLIENT@192.168.76.76@00:0c:29:73:e6:7b, Protocol: mscng, Retrieved permanent login credentials\n2021 Apr  1 09:31:29 UTC NUFENEN notice MSCNG Process: Disconnect: User: DEMO-TEST Client: SecurosysKspCfg@W10C-TESTCLIENT@192.168.76.76@00:0c:29:73:e6:7b over TCP connection 536870926 (IP 178.198.217.194:31550)\n2021 Apr  1 09:31:29 UTC NUFENEN info Crypto Process: Usage statistics: User: DEMO-TEST, Client: SecurosysKspCfg@W10C-TESTCLIENT@192.168.76.76@00:0c:29:73:e6:7b, Protocol: mscng, Total key usage count: 0\n...\n2021 Apr  1 09:35:47 UTC NUFENEN err Crypto Process: Error: Command: CommandGetKeyFlag, User: DEMO-TEST, Client: hsmcons@W10C-TESTCLIENT@192.168.76.76@00:0c:29:73:e6:7b, Protocol: mscng, 0x12 (C_GetAttributeValue: Requested attribute type is not valid)\n2021 Apr  1 09:35:48 UTC NUFENEN err Crypto message repeated 11 times: [ Process: Error: Command: CommandGetKeyFlag, User: DEMO-TEST, Client: hsmcons@W10C-TESTCLIENT@192.168.76.76@00:0c:29:73:e6:7b, Protocol: mscng, 0x12 (C_GetAttributeValue: Requested attribute type is not valid)]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["As ",(0,r.jsx)(n.code,{children:"--hsm <hsm or host name>"})," parameter you can use hsm",(0,r.jsx)(n.strong,{children:"x"}),"\n(",(0,r.jsx)(n.strong,{children:"x"}),"=0...n) reference, or the host name, exactly as configured in\nprimus.cfg. The HSM configuration must ",(0,r.jsx)(n.a,{href:"/pkcs/Installation/primus_hsm_settings#user-log-via-pkcs11-api",children:"allow log fetching via\nAPI"}),". Please note that ",(0,r.jsx)(n.strong,{children:"the log ring buffer\ncould overwrite old entries"}),". Consult the ",(0,r.jsx)(n.a,{href:"https://support.securosys.com/external/knowledge-base/article/63",children:"HSM User Guide"})," for\ndescription of the different log entries."]}),"\n",(0,r.jsx)(n.h2,{id:"connection-test",children:"Connection Test"}),"\n",(0,r.jsx)(n.p,{children:"The ppin tool allows to test connectivity to all defined HSMs and\npartitions, and optional arguments help to select a specific HSM or\npartition (provider version 1.8.1+):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ppin --test [--hsm hsm] [--user HSM_USERNAME]\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"Load config file: '/etc/primus/primus.cfg'\n\nhsm0: Connect to '82.197.162.10' on port 2411, firmware: RP-2.10.0-T \n    slot0 (id=2), user=DEMO-TEST: OK\n\nNumber of tested HSMs: 1 (number of partitions: 1)\nNumber of failures: 0\n"})}),"\n",(0,r.jsx)(n.h2,{id:"fortigate-secret-string",children:"FortiGate Secret String"}),"\n",(0,r.jsx)(n.p,{children:"The FortiGate firewall with built-in PKCS#11 provider v2.2.4+ requires the secrets file as base-64 encoded string, fetched on a client PC using the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ppin --fortinet --user <username> [<setupPassword> <PKCS11Password>] [--proxyuser <proxyUserName> [--proxypassword <proxyPassword>]]\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"# Fortinet secret to be loaded:\ndmVyc2lvbiA9ICIxLjAiOwpwcmltdXMgOiAKewogIHVzZXJzIDogCiAgewogICAgdXNlcjAgOiAKICAgIHsKICAgICAgbmFtZSA9ICJQUklNVVNERVYzNjgiOwogICAgICBdpY3MgPSAiMzcwYzJj\n... \nGUwY2Y4ZjNhNTkwMzE2ZjE4MGI4YWZlNDdiMzY1Nzg1ZWQ3NyI7CiAgICB9OwogIH07Cn07Cg==\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For details consult the ",(0,r.jsx)(n.a,{href:"/fortigate/overview",children:"FortiGate Integration Guide"}),"."]}),"\n","\n",(0,r.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,r.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{id:"user-content-fn-1",children:["\n",(0,r.jsxs)(n.p,{children:["On Windows platforms called ppin.exe ",(0,r.jsx)(n.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);