"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[20290],{3034:(e,t,n)=>{n.d(t,{A:()=>r});const r=n.p+"assets/images/mtls-tsb-5ead0c9be1b107ae36c1bb219467a9d7.png"},6775:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Installation/https-setup/mtls-configuration","title":"Configuring mTLS with REST-API","description":"Guide to setting up Mutual Transport Layer Security (mTLS) with Securosys TSBaaS and On-Premise Deployment.","source":"@site/tsb/Installation/https-setup/mtls-configuration.md","sourceDirName":"Installation/https-setup","slug":"/Installation/https-setup/mtls-configuration","permalink":"/tsb/Installation/https-setup/mtls-configuration","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Configuring mTLS with REST-API","sidebar_label":"Configure mTLS","description":"Guide to setting up Mutual Transport Layer Security (mTLS) with Securosys TSBaaS and On-Premise Deployment.","keywords":["cybersecurity","data security","key management","cloud hsm","hsm key management","hsm cloud","hsm as a service","cloud based hsm","hsm digital signature","hsm services","hsm service","hsm","hardware security module","mTLS setup","client certificate generation","OpenSSL","OCSP","trust management","PKCS12","Docker installation","Securosys TSBaaS"]},"sidebar":"tutorialSidebar","previous":{"title":"Platforms & Installation","permalink":"/tsb/Installation/Miscellaneous/supported_platforms"},"next":{"title":"Configure HTTPS","permalink":"/tsb/Installation/https-setup/tls-configuration"}}');var s=n(74848),i=n(28453),a=n(65537),o=n(79329);const c={sidebar_position:1,title:"Configuring mTLS with REST-API",sidebar_label:"Configure mTLS",description:"Guide to setting up Mutual Transport Layer Security (mTLS) with Securosys TSBaaS and On-Premise Deployment.",keywords:["cybersecurity","data security","key management","cloud hsm","hsm key management","hsm cloud","hsm as a service","cloud based hsm","hsm digital signature","hsm services","hsm service","hsm","hardware security module","mTLS setup","client certificate generation","OpenSSL","OCSP","trust management","PKCS12","Docker installation","Securosys TSBaaS"]},l="Configure mTLS",u={},d=[{value:"Initial Setup",id:"initial-setup",level:2},{value:"Root",id:"root",level:4},{value:"Intermediate",id:"intermediate",level:4},{value:"Client 2 (singed by intermediate cert)",id:"client-2-singed-by-intermediate-cert",level:4},{value:"Revoke Access / Trust a new certificate",id:"revoke-access--trust-a-new-certificate",level:2},{value:"Attention",id:"attention",level:3},{value:"Generating PKCS12 Container for Client Truststore",id:"generating-pkcs12-container-for-client-truststore",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"configure-mtls",children:"Configure mTLS"})}),"\n",(0,s.jsx)(t.p,{children:"Mutual Transport Layer Security (mTLS) is a security protocol that enhances the traditional Transport Layer Security (TLS) by requiring both the server and the client to authenticate each other. In a typical TLS handshake, the server is authenticated to the client, but in mTLS, the client also presents a digital certificate for authentication to the server. This mutual authentication adds an extra layer of security, ensuring that both parties can trust each other's identity. Once the authentication is successful, secure communication is established with the encryption of data exchanged between the client and the server."}),"\n",(0,s.jsxs)(t.p,{children:["In the following you are going to create the ",(0,s.jsx)(t.strong,{children:"root"}),", ",(0,s.jsx)(t.strong,{children:"intermediate"})," and ",(0,s.jsx)(t.strong,{children:"Client 2"})," Certificates and keys in order to demonstrate a successful mTLS setup."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{src:n(3034).A+"",width:"919",height:"579"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(t.h1,{id:"cloudshsm---tsbaas-dedicated-instance",children:"CloudsHSM - TSBaaS (dedicated instance)"}),"\n",(0,s.jsx)(t.h2,{id:"initial-setup",children:"Initial Setup"}),"\n",(0,s.jsxs)(t.p,{children:["As a TSBaaS customer, you must provide the Securosys Support Team with a valid client certificate to establish the initial trust. The following guide shows how to generate a client certificate using OpenSSL. ",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(t.strong,{children:"Note"})," that some organizations may prefer to use their own Public Key Infrastructure (PKI) or certificate utility."]}),"\n",(0,s.jsx)(t.p,{children:"Generating a Client Certificate with OpenSSL:"}),"\n",(0,s.jsx)(t.h4,{id:"root",children:"Root"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"openssl req -new -x509 -nodes -sha256 -newkey rsa:4096 -days 3650 -subj '/CN=localhost' -keyout ca.key -out ca.crt\n"})}),"\n",(0,s.jsx)(t.h4,{id:"intermediate",children:"Intermediate"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:'openssl genrsa -out intermediate.key 4096\nopenssl req -new -subj "/CN=intermediate" -key intermediate.key -out intermediate.csr\nopenssl x509 -req -in intermediate.csr -sha256 -CA ca.crt -CAkey ca.key -CAcreateserial -days 3650 -out intermediate.crt\n'})}),"\n",(0,s.jsx)(t.h4,{id:"client-2-singed-by-intermediate-cert",children:"Client 2 (singed by intermediate cert)"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:'openssl genrsa -out client-singed-by-inermediate.key 4096\nopenssl req -new -subj "/CN=client-singed-by-inermediate" -key client-singed-by-inermediate.key -out client-singed-by-inermediate.csr\nopenssl x509 -req -in client-singed-by-inermediate.csr -sha256 -CA intermediate.crt -CAkey intermediate.key -CAcreateserial -days 3650 -out client-singed-by-inermediate.crt\n'})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Action:"})," Send either the intermediate or client-certificate to Securosys Support Team. We will setup your service accordingly and notify you."]}),"\n",(0,s.jsx)(t.h2,{id:"revoke-access--trust-a-new-certificate",children:"Revoke Access / Trust a new certificate"}),"\n",(0,s.jsx)(t.p,{children:"To manage (add/remove) trusted client certificates, you have two options:"}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:"Please note that any security policy change acquired via a support ticket incurs a service fee.\nTo limit this cost and increase your flexibility, you may use your own OCSP server to manage trust."})}),"\n",(0,s.jsxs)(a.A,{groupId:"trust-management",children:[(0,s.jsx)(o.A,{value:"manualconfig",label:"Manual Trust Management",default:!0,children:(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Create Support Ticket"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Submit a support ticket with instructions on adding or removing a client certificate."}),"\n",(0,s.jsx)(t.li,{children:"Use the following Ticket Type: 5 - Change request -> CloudHSM -> Security Policy Change"}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Note:"})," Only ",(0,s.jsx)(t.a,{href:"https://support.securosys.com/external/knowledge-base/article/12",children:"Security Manager Clouds"})," are authorized to make Security Change requests."]}),"\n"]}),"\n"]})}),(0,s.jsxs)(o.A,{value:"ocsp",label:"OCSP",children:[(0,s.jsx)(t.p,{children:"The Online Certificate Status Protocol (OCSP) is used to check the revocation status of digital certificates in real-time. This allows TSB to verify whether a client certificate has been revoked or remains valid. Note that this check is executed on each request and may introduce a delay."}),(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Setting Up an OCSP Responder"})}),(0,s.jsx)(t.p,{children:"You have the following options for deploying an OCSP responder:"}),(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Deploy your own OCSP responder."}),"\n",(0,s.jsx)(t.li,{children:"Use an OCSP responder from your PKI."}),"\n",(0,s.jsx)(t.li,{children:"Use an OCSP responder provided by AWS."}),"\n"]}),(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Configuring the Client Certificate"}),(0,s.jsx)("br",{}),"\nEnsure your client certificate includes the following X509v3 extension to specify the OCSP responder:"]}),(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"        X509v3 extensions:\n          Authority Information Access: \n              OCSP - URI:http://<your-ocsp-responder>.com\n"})}),(0,s.jsxs)(t.p,{children:["Replace ",(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"<your-ocsp-responder>.com"})})," with the actual URI of your OCSP responder."]}),(0,s.jsx)(t.hr,{}),(0,s.jsx)(t.hr,{}),(0,s.jsx)(t.h3,{id:"attention",children:"Attention"}),(0,s.jsx)(t.p,{children:(0,s.jsx)(t.em,{children:(0,s.jsx)(t.em,{children:"Since the revocation status check (OCSP) is an external service not controlled by Securosys and is performed on every request, the OCSP service is explicitly excluded from the Service Level Agreement (SLA) between Securosys and its clients. Therefore, please ensure you have optimal availability for your OCSP service."})})})]})]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h1,{id:"on-premise-deployment",children:"On-Premise Deployment"}),"\n",(0,s.jsx)(t.p,{children:"Add the Client Certificate (Public) to Server-TrustStore:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"keytool -importcert -keystore securosys-ska-truststore-server.jks -alias client-signed-by-intermediate-public -file client-singed-by-inermediate.crt -storepass secret\n"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Copy the generated ",(0,s.jsx)(t.code,{children:"securosys-ska-truststore-server.jks"})," file to the ",(0,s.jsx)(t.code,{children:"config-files/tls"})," folder within the securosys-tsb directory. Create the ",(0,s.jsx)(t.code,{children:"**tls**"})," directory if it does not exist."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Modify the following properties in the application-local.yml file:"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"# Trust-Store configuration (m)TLS\nserver:\n  ssl:\n    # add client certificates and/or CA's to the trustStore if you want mTLS, otherwise comment out.\n    trust-store: 'file:/etc/app/config/tls/securosys-ska-truststore-server.jks'\n    trust-store-password: secret # yourTrustStorePassword\n    trust-store-type: jks\n    # (Enum: `need` [Client authentication is needed and mandatory], `none` [Client authentication is not wanted], `want` [Client authentication is wanted but not mandatory])\n    client-auth: need\n"})}),"\n",(0,s.jsxs)(t.ol,{start:"3",children:["\n",(0,s.jsx)(t.li,{children:"Run or restart the Docker container:"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"docker-compose down\ndocker-compose up\n"})}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(t.h3,{id:"generating-pkcs12-container-for-client-truststore",children:"Generating PKCS12 Container for Client Truststore"}),"\n",(0,s.jsx)(t.p,{children:"To facilitate usage with both CURL and web browsers, generate a PKCS12 container for Client2."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"openssl pkcs12 -export -out client-truststore-CLIENT_SIGNED_BY_INTERMEDIATE.p12 -inkey client-singed-by-inermediate.key -in client-singed-by-inermediate.crt -password pass:secret\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This command creates a PKCS12 container named ",(0,s.jsx)(t.code,{children:"client-truststore-CLIENT_SIGNED_BY_INTERMEDIATE.p12"}),", incorporating the private key (client-signed-by-intermediate.key) and the corresponding certificate (client-signed-by-intermediate.crt). The password for the container is set to ",(0,s.jsx)(t.code,{children:"secret"}),"."]}),"\n",(0,s.jsx)(t.h1,{id:"testing-with-curl",children:"Testing with CURL"}),"\n",(0,s.jsxs)(t.admonition,{type:"danger",children:[(0,s.jsx)(t.mdxAdmonitionTitle,{}),(0,s.jsxs)(t.p,{children:["Do not use the ",(0,s.jsx)(t.code,{children:"--insecure"})," flag in productive environment, replace it with the ",(0,s.jsx)(t.code,{children:"--cacert"})," flag or use a public CA instead."]})]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"curl -v --insecure --cert-type P12 --cert client-truststore-CLIENT_SIGNED_BY_INTERMEDIATE.p12:secret https://localhost:8080/v1/key\n"})})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var r=n(96540);const s={},i=r.createContext(s);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:t},e.children)}},65537:(e,t,n)=>{n.d(t,{A:()=>v});var r=n(96540),s=n(34164),i=n(65627),a=n(56347),o=n(50372),c=n(30604),l=n(11861),u=n(78749);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:s}}=e;return{value:t,label:n,attributes:r,default:s}}))}(n);return function(e){const t=(0,l.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const s=(0,a.W6)(),i=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,c.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(s.location.search);t.set(i,e),s.replace({...s.location,search:t.toString()})}),[i,s])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:s}=e,i=h(e),[a,c]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:i}))),[l,d]=m({queryString:n,groupId:s}),[g,y]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[s,i]=(0,u.Dv)(n);return[s,(0,r.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:s}),f=(()=>{const e=l??g;return p({value:e,tabValues:i})?e:null})();(0,o.A)((()=>{f&&c(f)}),[f]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);c(e),d(e),y(e)}),[d,y,i]),tabValues:i}}var y=n(9136);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=n(74848);function b(e){let{className:t,block:n,selectedValue:r,selectValue:a,tabValues:o}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),u=e=>{const t=e.currentTarget,n=c.indexOf(t),s=o[n].value;s!==r&&(l(t),a(s))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},t),children:o.map((e=>{let{value:t,label:n,attributes:i}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>{c.push(e)},onKeyDown:d,onClick:u,...i,className:(0,s.A)("tabs__item",f.tabItem,i?.className,{"tabs__item--active":r===t}),children:n??t},t)}))})}function j(e){let{lazy:t,children:n,selectedValue:i}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===i));return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:a.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==i})))})}function S(e){const t=g(e);return(0,x.jsxs)("div",{className:(0,s.A)("tabs-container",f.tabList),children:[(0,x.jsx)(b,{...t,...e}),(0,x.jsx)(j,{...t,...e})]})}function v(e){const t=(0,y.A)();return(0,x.jsx)(S,{...e,children:d(e.children)},String(t))}},79329:(e,t,n)=>{n.d(t,{A:()=>a});n(96540);var r=n(34164);const s={tabItem:"tabItem_Ymn6"};var i=n(74848);function a(e){let{children:t,hidden:n,className:a}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,a),hidden:n,children:t})}}}]);