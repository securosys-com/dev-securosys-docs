"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[85958],{28453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>i});var n=t(96540);const a={},s=n.createContext(a);function o(e){const r=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(s.Provider,{value:r},e.children)}},38922:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>u});const n=JSON.parse('{"id":"Tutorials/Securing-Vault-Server-Key/Migrate-Vault-Key-to-HSM","title":"How to Migrate an Vault Server Key to HSM for CyberArk","description":"Migrate your existing CyberArk Vault server key to a Securosys CloudHSM or Primus HSM, ensuring secure key management.","source":"@site/cyberark/Tutorials/Securing-Vault-Server-Key/Migrate-Vault-Key-to-HSM.md","sourceDirName":"Tutorials/Securing-Vault-Server-Key","slug":"/Tutorials/Securing-Vault-Server-Key/Migrate-Vault-Key-to-HSM","permalink":"/cyberark/Tutorials/Securing-Vault-Server-Key/Migrate-Vault-Key-to-HSM","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"How to Migrate an Vault Server Key to HSM for CyberArk","sidebar_label":"Key Migration","description":"Migrate your existing CyberArk Vault server key to a Securosys CloudHSM or Primus HSM, ensuring secure key management.","keywords":["hsm","cloud hsm"]},"sidebar":"tutorialSidebar","previous":{"title":"Key Generation","permalink":"/cyberark/Tutorials/Securing-Vault-Server-Key/Generate-Vault-Key-on-HSM"},"next":{"title":"Concepts","permalink":"/cyberark/category/concepts"}}');var a=t(74848),s=t(28453);t(65537),t(79329);const o={sidebar_position:2,title:"How to Migrate an Vault Server Key to HSM for CyberArk",sidebar_label:"Key Migration",description:"Migrate your existing CyberArk Vault server key to a Securosys CloudHSM or Primus HSM, ensuring secure key management.",keywords:["hsm","cloud hsm"]},i="Migrate a Vault Server Key to the HSM",l={},u=[];function c(e){const r={admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"migrate-a-vault-server-key-to-the-hsm",children:"Migrate a Vault Server Key to the HSM"})}),"\n",(0,a.jsxs)(r.admonition,{title:"CAUTION",type:"warning",children:[(0,a.jsx)(r.p,{children:"The CyberArk Vault server key can be used with Securosys CloudHSM or on-premise Primus HSM using one of the two following methods:"}),(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Generating the CyberArk Vault Server Key on the Securosys CloudHSM or Primus HSM"}),"\n",(0,a.jsx)(r.li,{children:"Importing the CyberArk Vault Server Key onto the Securosys CloudHSM or Primus HSM"}),"\n"]}),(0,a.jsx)(r.p,{children:"It is heavily advisable to generate the Vault\u2019s server key on the HSM as this way the private key is always kept in a secure environment and is never exposed."})]}),"\n",(0,a.jsx)(r.p,{children:"Although not as secure as generating the key directy on the HSM, there might be situations where existing keys must be loaded onto HSM. In such cases proceed as below:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Stop the PrivateArk Server."}),"\n",(0,a.jsx)(r.li,{children:"Navigate to the Server directory. In the directory open a command prompt with administrative privileges."}),"\n",(0,a.jsx)(r.li,{children:"(Optional) For a more verbose output when generating a new server key on the HSM use the following command:"}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-sh",children:"Set CACryptoTrace=1\n"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Using ",(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"CAVaultManager"})}),", run the ",(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"LoadServerKeyToHSM"})})," command to upload the server key to store in the HSM server:"]}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-sh",children:"CAVaultManager.exe LoadServerKeyToHSM /WrapKey\n"})}),"\n",(0,a.jsx)(r.p,{children:"The command generates a new key pair. The public key is used to encrypt the server key, and the private key decrypts it on the HSM device. The private key is deleted from HSM when the server key is un-wrapped.\nThe output result must inform you that the server key has been successfully uploaded to the HSM, as seen in the example below:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-sh",children:"CAVLT143I Server Key was successfully uploaded to HSM device\n"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:["Open the ",(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"DBParm.ini"})})," file located in ",(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"Server\\Conf"})}),".\nSet the ",(0,a.jsx)(r.strong,{children:(0,a.jsx)(r.code,{children:"ServerKey"})})," parameter to use the Securosys CloudHSM:"]}),"\n"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-sh",children:"ServerKey=HSM\n"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"Make sure to save the file before starting the PrivateArk Server."}),"\n",(0,a.jsx)(r.li,{children:"Start the PrivateArk Server and verify that there are no errors in the console."}),"\n",(0,a.jsx)(r.li,{children:"Verify that you can log on to the Vault using CyberArk authentication."}),"\n"]}),"\n",(0,a.jsx)(r.p,{children:"This completes the migration of existing server key to Securosys CloudHSM or on-premise PrimusHSM."})]})}function d(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},65537:(e,r,t)=>{t.d(r,{A:()=>k});var n=t(96540),a=t(34164),s=t(65627),o=t(56347),i=t(50372),l=t(30604),u=t(11861),c=t(78749);function d(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:r}=e;return!!r&&"object"==typeof r&&"value"in r}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:r,children:t}=e;return(0,n.useMemo)((()=>{const e=r??function(e){return d(e).map((e=>{let{props:{value:r,label:t,attributes:n,default:a}}=e;return{value:r,label:t,attributes:n,default:a}}))}(t);return function(e){const r=(0,u.XI)(e,((e,r)=>e.value===r.value));if(r.length>0)throw new Error(`Docusaurus error: Duplicate values "${r.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[r,t])}function p(e){let{value:r,tabValues:t}=e;return t.some((e=>e.value===r))}function y(e){let{queryString:r=!1,groupId:t}=e;const a=(0,o.W6)(),s=function(e){let{queryString:r=!1,groupId:t}=e;if("string"==typeof r)return r;if(!1===r)return null;if(!0===r&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:r,groupId:t});return[(0,l.aZ)(s),(0,n.useCallback)((e=>{if(!s)return;const r=new URLSearchParams(a.location.search);r.set(s,e),a.replace({...a.location,search:r.toString()})}),[s,a])]}function m(e){const{defaultValue:r,queryString:t=!1,groupId:a}=e,s=h(e),[o,l]=(0,n.useState)((()=>function(e){let{defaultValue:r,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(r){if(!p({value:r,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${r}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return r}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:r,tabValues:s}))),[u,d]=y({queryString:t,groupId:a}),[m,g]=function(e){let{groupId:r}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(r),[a,s]=(0,c.Dv)(t);return[a,(0,n.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:a}),v=(()=>{const e=u??m;return p({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{v&&l(v)}),[v]);return{selectedValue:o,selectValue:(0,n.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),g(e)}),[d,g,s]),tabValues:s}}var g=t(9136);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function S(e){let{className:r,block:t,selectedValue:n,selectValue:o,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,s.a_)(),c=e=>{const r=e.currentTarget,t=l.indexOf(r),a=i[t].value;a!==n&&(u(r),o(a))},d=e=>{let r=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;r=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;r=l[t]??l[l.length-1];break}}r?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":t},r),children:i.map((e=>{let{value:r,label:t,attributes:s}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:n===r?0:-1,"aria-selected":n===r,ref:e=>{l.push(e)},onKeyDown:d,onClick:c,...s,className:(0,a.A)("tabs__item",v.tabItem,s?.className,{"tabs__item--active":n===r}),children:t??r},r)}))})}function f(e){let{lazy:r,children:t,selectedValue:s}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(r){const e=o.find((e=>e.props.value===s));return e?(0,n.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:o.map(((e,r)=>(0,n.cloneElement)(e,{key:r,hidden:e.props.value!==s})))})}function x(e){const r=m(e);return(0,b.jsxs)("div",{className:(0,a.A)("tabs-container",v.tabList),children:[(0,b.jsx)(S,{...r,...e}),(0,b.jsx)(f,{...r,...e})]})}function k(e){const r=(0,g.A)();return(0,b.jsx)(x,{...e,children:d(e.children)},String(r))}},79329:(e,r,t)=>{t.d(r,{A:()=>o});t(96540);var n=t(34164);const a={tabItem:"tabItem_Ymn6"};var s=t(74848);function o(e){let{children:r,hidden:t,className:o}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,n.A)(a.tabItem,o),hidden:t,children:r})}}}]);