"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[8505],{5340:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Always-encrypted-summary-624ce905de43c47203233ee7be0b8fd1.png"},25334:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/object-explorer-encrypt-columns-cb95630229273e46e4996aa1dd6ef9ed.png"},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(96540);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}},52128:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"Installation/enabling-column-encryption","title":"Enabling Microsoft SQL Always Encrypted","description":"Enabling Microsoft SQL Always Encrypted with Securosys Hardware Security Modules (HSMs)","source":"@site/ms-sql-ae/Installation/enabling-column-encryption.md","sourceDirName":"Installation","slug":"/Installation/enabling-column-encryption","permalink":"/ms-sql-ae/Installation/enabling-column-encryption","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Enabling Microsoft SQL Always Encrypted","sidebar_label":"5. Enable Always Encrypted","description":"Enabling Microsoft SQL Always Encrypted with Securosys Hardware Security Modules (HSMs)","keywords":["cloud hsm","hsm key management","hsm cloud"]},"sidebar":"tutorialSidebar","previous":{"title":"4. Create Encryption Key (CEK)","permalink":"/ms-sql-ae/Installation/creating-cek"},"next":{"title":"Tutorial","permalink":"/ms-sql-ae/category/tutorial"}}');var s=t(74848),r=t(28453),i=t(65537),o=t(79329);const l={sidebar_position:4,title:"Enabling Microsoft SQL Always Encrypted",sidebar_label:"5. Enable Always Encrypted",description:"Enabling Microsoft SQL Always Encrypted with Securosys Hardware Security Modules (HSMs)",keywords:["cloud hsm","hsm key management","hsm cloud"]},c="Enable Column Encryption on the Database Table",d={},u=[];function h(e){const n={code:"code",h1:"h1",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"enable-column-encryption-on-the-database-table",children:"Enable Column Encryption on the Database Table"})}),"\n",(0,s.jsxs)(n.p,{children:["To enable ",(0,s.jsx)(n.strong,{children:"Always Encrypted"}),", you can either use the Graphical User Interface (GUI) or the Command Line Interface (CLI) process, depending on your preference:"]}),"\n",(0,s.jsxs)(i.A,{groupId:"Column Encryption Key",children:[(0,s.jsxs)(o.A,{value:"gui",label:"Graphical User Interface (GUI)",default:!0,children:[(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["To enable Always Encrypted (and generate a Column Encryption Key), right-click on the required database (",(0,s.jsx)(n.code,{children:"HSMDemoDB"})," in this example)."]}),"\n"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.code,{children:"Tasks"})," -> ",(0,s.jsx)(n.code,{children:" Encrypt Columns\u2026"})," to open the Always Encrypted wizard."]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(25334).A+"",width:"722",height:"280"})}),(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Next >"})," to skip the Introduction page."]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(70806).A+"",width:"738",height:"684"})}),(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"The Column Selection screen allows to specify the columns to encrypt, the encryption type and the Column Encryption Key."}),"\n"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Under ",(0,s.jsx)(n.code,{children:"Encryption Type"})," choose the encryption method from the drop-down box:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Deterministic ",(0,s.jsx)("br",{})," \u201cUses a method which always generates the same encrypted value for any given plain text value. Using deterministic encryption allows grouping, filtering by equality, and joining tables based on encrypted values, but can also allow unauthorized users to guess information about encrypted values by examining patterns in the encrypted column. This weakness is increased when there is a small set of possible encrypted values, such as True/False, Yes/No etc. Deterministic encryption must use a column collation with a binary2 sort order for character columns.\u201d"]}),"\n",(0,s.jsxs)(n.li,{children:["Randomized ",(0,s.jsx)("br",{})," \u201cUses a method that encrypts data in a less predictable manner. Randomized encryption is more secure, but prevents equality searches, grouping, indexing, and joining on encrypted columns.\u201d"]}),"\n",(0,s.jsxs)(n.li,{children:["Plaintext ",(0,s.jsx)("br",{})," Only available to revert encrypted columns to an unencrypted state."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Select your previously defined Column Encryption Key. If it was not pre-defined, then you can use an automatically named CEK (e.g. ",(0,s.jsx)(n.code,{children:"CEK_Auto1 (New)"}),"), generated in the next step."]}),"\n",(0,s.jsxs)(n.li,{children:["If all necessary columns are defined properly, click ",(0,s.jsx)(n.code,{children:"Next >"})," to continue."]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(64397).A+"",width:"738",height:"684"})}),(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:["On the Master Key Configuration page:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Using existing CEK: no additional configuration necessary"}),"\n",(0,s.jsx)(n.li,{children:"Generating a new CEK: make sure that you select the proper CMK (e.g. generated using the Primus CNG/KSP Provider)"}),"\n"]}),"\n"]}),"\n"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Next >"})," to continue."]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(73467).A+"",width:"738",height:"684"})}),(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:"The process of encrypting database records can take a considerable amount of time, depending on the size and quantity of data. To mitigate the possibility of data corruption occurring as records are encrypted whilst being updated, it is advisable to back up the database and to only perform this activity when the database is offline (schedule maintenance downtime)."}),"\n"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["In our case, we will continue and run the encryption straight away. Select the radio button, ",(0,s.jsx)(n.code,{children:"Proceed to finish now"})," this will begin creating the CEK if necessary and using it to encrypt the specified columns in the database."]}),"\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Next >"})," to view the Summary page"]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(77297).A+"",width:"738",height:"684"})}),(0,s.jsxs)(n.ol,{start:"6",children:["\n",(0,s.jsx)(n.li,{children:"This page allows you to verify your configuration choices."}),"\n"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Finish"})," to view the Results page."]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(5340).A+"",width:"738",height:"684"})}),(0,s.jsxs)(n.ol,{start:"7",children:["\n",(0,s.jsxs)(n.li,{children:["Click ",(0,s.jsx)(n.code,{children:"Close"})," to exit the Always Encrypted wizard."]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(53146).A+"",width:"738",height:"684"})}),(0,s.jsxs)(n.ol,{start:"8",children:["\n",(0,s.jsxs)(n.li,{children:["If you now open the table by right-clicking on the database table and selecting ",(0,s.jsx)(n.code,{children:"Select Top 1000 Rows"})," you will see that the columns selected for encryption now appear as ciphertext."]}),"\n"]}),(0,s.jsx)(n.p,{children:"Example column with encryption:"}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(77528).A+"",width:"514",height:"223"})}),(0,s.jsx)(n.p,{children:"Example column without encryption:"}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(85898).A+"",width:"304",height:"227"})})]}),(0,s.jsxs)(o.A,{value:"cli",label:"Command Line Interface (CLI))",default:!0,children:[(0,s.jsxs)(n.p,{children:["Open a ",(0,s.jsx)(n.code,{children:"PowerShell"})," (or ",(0,s.jsx)(n.code,{children:"PowerShell ISE"}),") session with elevated permissions (right-click and select ",(0,s.jsx)(n.code,{children:"Run as Administrator"}),") and run the following to encrypt a given column in the specified database. Adjust the highlighted values to those suitable for your database name and data columns that you want to encrypt."]}),(0,s.jsxs)(n.p,{children:["Remember, the ",(0,s.jsx)(n.code,{children:"EncryptionType"})," values are one of either: Deterministic, Randomized, Plaintext."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'# Import Module SqlServer \nImport-Module SqlServer \n\n# Set up connection and database SMO objects \n$sqlConnectionString = "Data Source=server_name;Initial Catalog=your_database;Integrated Security=True;MultipleActiveResultSets=False;Connect Timeout=30;Encrypt=False;TrustServerCertificate=False;Packet Size=4096;Application Name=`"Microsoft SQL Server Management Studio`"" \n$smoDatabase = Get-SqlDatabase -ConnectionString $sqlConnectionString \n\n# Change encryption schema \n$encryptionChanges = @() \n\n# Add changes for table [dbo].[DemoTable] \n$encryptionChanges += New-SqlColumnEncryptionSettings -ColumnName dbo.DemoTable.ColToEncrypt \n-EncryptionType Randomized -EncryptionKey "AlwaysEncryptedCEK"\nSet-SqlColumnEncryption -ColumnEncryptionSettings $encryptionChanges -InputObject $smoDatabase\nE.g. using our example database \u201chsmdemodb\u201d:\n# Import Module SqlServer\nImport-Module SqlServer \n\n# Set up connection and database SMO objects \n$sqlConnectionString = "Data Source=DEMO-SRV;Initial Catalog=hsmdemodb;Integrated Security=True;MultipleActiveResultSets=False;Connect Timeout=30;Encrypt=False;TrustServerCertificate=False;Packet Size=4096;Application Name=`"Microsoft SQL Server Management Studio`"" \n$smoDatabase = Get-SqlDatabase -ConnectionString $sqlConnectionString \n\n# Change encryption schema \n$encryptionChanges = @() \n\n# Add changes for table [dbo].[hsmdemodb]\n$encryptionChanges += New-SqlColumnEncryptionSettings -ColumnName dbo.CCards.CNumber -EncryptionType Randomized -EncryptionKey "AlwaysEncryptedCEK" \nSet-SqlColumnEncryption -ColumnEncryptionSettings $encryptionChanges -InputObject $smoDatabase\n'})}),(0,s.jsxs)(n.p,{children:["Example with our database ",(0,s.jsx)(n.code,{children:"hsmdemodb"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'# Import Module SqlServer\nImport-Module SqlServer \n\n# Set up connection and database SMO objects \n$sqlConnectionString = "Data Source=DEMO-SRV;Initial Catalog=hsmdemodb;Integrated Security=True;MultipleActiveResultSets=False;Connect Timeout=30;Encrypt=False;TrustServerCertificate=False;Packet Size=4096;Application Name=`"Microsoft SQL Server Management Studio`"" \n$smoDatabase = Get-SqlDatabase -ConnectionString $sqlConnectionString \n\n# Change encryption schema \n$encryptionChanges = @() \n\n# Add changes for table [dbo].[hsmdemodb]\n$encryptionChanges += New-SqlColumnEncryptionSettings -ColumnName dbo.CCards.CNumber -EncryptionType Randomized -EncryptionKey "AlwaysEncryptedCEK" \nSet-SqlColumnEncryption -ColumnEncryptionSettings $encryptionChanges -InputObject $smoDatabase\n'})})]})]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},53146:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Always-encrypted-results-55a2a5d736aaad98d927c15866b49495.png"},64397:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Always-encrypted-column-selection-3dcd3eddd189e2e2c2ac669f725ff3ef.png"},65537:(e,n,t)=>{t.d(n,{A:()=>w});var a=t(96540),s=t(34164),r=t(65627),i=t(56347),o=t(50372),l=t(30604),c=t(11861),d=t(78749);function u(e){return a.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:s}}=e;return{value:n,label:t,attributes:a,default:s}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const s=(0,i.W6)(),r=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(r),(0,a.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(s.location.search);n.set(r,e),s.replace({...s.location,search:n.toString()})}),[r,s])]}function y(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,r=h(e),[i,l]=(0,a.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const a=t.find((e=>e.default))??t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:r}))),[c,u]=m({queryString:t,groupId:s}),[y,b]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,r]=(0,d.Dv)(t);return[s,(0,a.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:s}),g=(()=>{const e=c??y;return p({value:e,tabValues:r})?e:null})();(0,o.A)((()=>{g&&l(g)}),[g]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),b(e)}),[u,b,r]),tabValues:r}}var b=t(9136);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(74848);function x(e){let{className:n,block:t,selectedValue:a,selectValue:i,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),d=e=>{const n=e.currentTarget,t=l.indexOf(n),s=o[t].value;s!==a&&(c(n),i(s))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},n),children:o.map((e=>{let{value:n,label:t,attributes:r}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:a===n?0:-1,"aria-selected":a===n,ref:e=>{l.push(e)},onKeyDown:u,onClick:d,...r,className:(0,s.A)("tabs__item",g.tabItem,r?.className,{"tabs__item--active":a===n}),children:t??n},n)}))})}function j(e){let{lazy:n,children:t,selectedValue:r}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function S(e){const n=y(e);return(0,f.jsxs)("div",{className:(0,s.A)("tabs-container",g.tabList),children:[(0,f.jsx)(x,{...n,...e}),(0,f.jsx)(j,{...n,...e})]})}function w(e){const n=(0,b.A)();return(0,f.jsx)(S,{...e,children:u(e.children)},String(n))}},70806:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Always-encrypted-introduction-a2ddd60beccaacf83b500084bf95dc62.png"},73467:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Always-encrypted-master-key-configuration-29808dad576da905c6ddaf6d2097cb6c.png"},77297:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Always-encrypted-run-settings-74362a3562ec8fba508bfb0ca85ddf72.png"},77528:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Column-with-encryption-4ab75271be1f8f1bb6c7e4018cae1a83.png"},79329:(e,n,t)=>{t.d(n,{A:()=>i});t(96540);var a=t(34164);const s={tabItem:"tabItem_Ymn6"};var r=t(74848);function i(e){let{children:n,hidden:t,className:i}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.A)(s.tabItem,i),hidden:t,children:n})}},85898:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Column-without-encryption-73891f4217cf8a73456cba57f9bfcb77.png"}}]);