"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[54841],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var r=t(96540);const o={},a=r.createContext(o);function s(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(a.Provider,{value:n},e.children)}},31484:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/Always-encrypted-column-selection-remove-a0bd13ba1e3f88b11bc5e9ed1762464f.png"},53249:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Tutorials/removing-column-encryption","title":"Removing Column Encrypted Database","description":"Removing Column Encryption for Microsoft SQL Always Encrypted with Securosys Hardware Security Modules (HSMs)","source":"@site/ms-sql-ae/Tutorials/removing-column-encryption.md","sourceDirName":"Tutorials","slug":"/Tutorials/removing-column-encryption","permalink":"/ms-sql-ae/Tutorials/removing-column-encryption","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Removing Column Encrypted Database","sidebar_label":"Removing Column Encryption","description":"Removing Column Encryption for Microsoft SQL Always Encrypted with Securosys Hardware Security Modules (HSMs)","keywords":["cloud hsm","hsm key management","hsm cloud"]},"sidebar":"tutorialSidebar","previous":{"title":"Connect Encrypted Database","permalink":"/ms-sql-ae/Tutorials/connecting-column-encrypted-db"},"next":{"title":"Shared User Access SQL","permalink":"/ms-sql-ae/Tutorials/Shared-access"}}');var o=t(74848),a=t(28453),s=t(65537),l=t(79329);const i={sidebar_position:1,title:"Removing Column Encrypted Database",sidebar_label:"Removing Column Encryption",description:"Removing Column Encryption for Microsoft SQL Always Encrypted with Securosys Hardware Security Modules (HSMs)",keywords:["cloud hsm","hsm key management","hsm cloud"]},c="Removing Column Encryption",u={},d=[];function m(e){const n={admonition:"admonition",code:"code",h1:"h1",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"removing-column-encryption",children:"Removing Column Encryption"})}),"\n",(0,o.jsxs)(n.p,{children:["Use the ",(0,o.jsx)(n.strong,{children:"SQL Server Management Studio"})," to remove the protection provided by Always Encrypted column encryption."]}),"\n",(0,o.jsxs)(s.A,{groupId:"Column Encryption Key",children:[(0,o.jsxs)(l.A,{value:"gui",label:"Graphical User Interface (GUI)",default:!0,children:[(0,o.jsx)(n.p,{children:"Right-click on the required database."}),(0,o.jsxs)(n.p,{children:["Select ",(0,o.jsx)(n.code,{children:"Tasks"})," -> ",(0,o.jsx)(n.code,{children:"Encrypt Columns\u2026"})," to open the Always Encrypted wizard."]}),(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(31484).A+"",width:"738",height:"684"})}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["On the Column Selection page change the Encryption type to ",(0,o.jsx)(n.code,{children:"Plaintext"})," for the columns to decrypt."]}),"\n",(0,o.jsxs)(n.li,{children:["If all necessary columns are defined properly, click ",(0,o.jsx)(n.code,{children:"Next >"})," ",(0,o.jsx)(n.code,{children:"Next >"})," ",(0,o.jsx)(n.code,{children:"Next >"})," and review on the Summary page that the correct Decrypt columns are listed."]}),"\n",(0,o.jsxs)(n.li,{children:["Click ",(0,o.jsx)(n.code,{children:"Finish"})," to see the Results page and click ",(0,o.jsx)(n.code,{children:"Close"}),".\nWhen you next log into the database you can remove the ",(0,o.jsx)(n.code,{children:"Column Encryption Setting = enabled"})," string from the ",(0,o.jsx)(n.code,{children:"Additional Connection Parameters"})," tab of the database login screen."]}),"\n"]})]}),(0,o.jsxs)(l.A,{value:"cli",label:"Command Line Interface (CLI))",default:!0,children:[(0,o.jsxs)(n.p,{children:["To remove column encryption from previously encrypted column data, replace the column EncryptionType value with ",(0,o.jsx)(n.code,{children:"Plaintext"})," and execute ",(0,o.jsx)(n.code,{children:"Set-SqlColumnEncryption"})," cmdlet."]}),(0,o.jsx)(n.p,{children:"Take the database preferably offline before proceeding to remove column encryption."}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'# Import Module SqlServer\nImport-Module SqlServer \n\n# Set up connection and database SMO objects \n$sqlConnectionString = "Data Source=server_name;Initial Catalog=your_database;Integrated Security=True;MultipleActiveResultSets=False;Connect Timeout=30;Encrypt=False;TrustServerCertificate=True;Packet Size=4096;Application Name=`\u201dMicrosoft SQL Server Management Studio`\u201d;Column Encryption Setting=Enabled\u201d \n$smoDatabase = Get-SqlDatabase \u2013ConnectionString $sqlConnectionString \n\n# Change encryption schema \n$encryptionChanges = @() \n\n# Add changes for table [dbo].[DemoTable] \n$encryptionChanges += New-SqlColumnEncryptionSettings \u2013ColumnName dbo.DemoTable.ColToDecrypt \n\u2013EncryptionType Plaintext\nSet-SqlColumnEncryption \u2013ColumnEncryptionSettings $encryptionChanges \u2013InputObject $smoDatabase\n'})}),(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Always Encrypted"})," column data will revert to plaintext.\nRemove the ",(0,o.jsx)(n.code,{children:"Column Encryption Setting = enabled"})," string from the ",(0,o.jsx)(n.code,{children:"Additional Connection Parameters"})," field of the database login screen."]}),(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"When removing Always Encryption from your database columns, ensure that all columns appear in plaintext. You must delete any Column Encryption Keys (CEK) before you can drop the Column Master Keys (CMK)."})})]})]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(m,{...e})}):m(e)}},65537:(e,n,t)=>{t.d(n,{A:()=>C});var r=t(96540),o=t(34164),a=t(65627),s=t(56347),l=t(50372),i=t(30604),c=t(11861),u=t(78749);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function m(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:o}}=e;return{value:n,label:t,attributes:r,default:o}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function h(e){let{queryString:n=!1,groupId:t}=e;const o=(0,s.W6)(),a=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,i.aZ)(a),(0,r.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(o.location.search);n.set(a,e),o.replace({...o.location,search:n.toString()})}),[a,o])]}function y(e){const{defaultValue:n,queryString:t=!1,groupId:o}=e,a=m(e),[s,i]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:a}))),[c,d]=h({queryString:t,groupId:o}),[y,b]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[o,a]=(0,u.Dv)(t);return[o,(0,r.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:o}),f=(()=>{const e=c??y;return p({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{f&&i(f)}),[f]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),d(e),b(e)}),[d,b,a]),tabValues:a}}var b=t(9136);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=t(74848);function v(e){let{className:n,block:t,selectedValue:r,selectValue:s,tabValues:l}=e;const i=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),u=e=>{const n=e.currentTarget,t=i.indexOf(n),o=l[t].value;o!==r&&(c(n),s(o))},d=e=>{let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const t=i.indexOf(e.currentTarget)+1;n=i[t]??i[0];break}case"ArrowLeft":{const t=i.indexOf(e.currentTarget)-1;n=i[t]??i[i.length-1];break}}n?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":t},n),children:l.map((e=>{let{value:n,label:t,attributes:a}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>{i.push(e)},onKeyDown:d,onClick:u,...a,className:(0,o.A)("tabs__item",f.tabItem,a?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function x(e){let{lazy:n,children:t,selectedValue:a}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function S(e){const n=y(e);return(0,g.jsxs)("div",{className:(0,o.A)("tabs-container",f.tabList),children:[(0,g.jsx)(v,{...n,...e}),(0,g.jsx)(x,{...n,...e})]})}function C(e){const n=(0,b.A)();return(0,g.jsx)(S,{...e,children:d(e.children)},String(n))}},79329:(e,n,t)=>{t.d(n,{A:()=>s});t(96540);var r=t(34164);const o={tabItem:"tabItem_Ymn6"};var a=t(74848);function s(e){let{children:n,hidden:t,className:s}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(o.tabItem,s),hidden:t,children:n})}}}]);