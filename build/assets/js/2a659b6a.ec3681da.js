"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[65377],{28453:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>l});var s=r(96540);const n={},a=s.createContext(n);function o(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(a.Provider,{value:t},e.children)}},45040:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Tutorials/Create-key-HSM","title":"AWS BYOK - How to create a key on the HSM","description":"It is necessary to generate a key on the HSM which will be imported to the AWS KMS. In the below example we create a key using Primus Tools, but a different tool can be used. If you will be using different tools please ensure to create the key with the proper parameters.","source":"@site/aws-byok/Tutorials/Create-key-HSM.md","sourceDirName":"Tutorials","slug":"/Tutorials/Create-key-HSM","permalink":"/aws-byok/Tutorials/Create-key-HSM","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"AWS BYOK - How to create a key on the HSM","sidebar_label":"Create Key on HSM"},"sidebar":"tutorialSidebar","previous":{"title":"Downloading Public Key & Import Token","permalink":"/aws-byok/Tutorials/Download-Pub-key"},"next":{"title":"Export & Wrap Key Material","permalink":"/aws-byok/Tutorials/Export&Wrap"}}');var n=r(74848),a=r(28453);r(65537),r(79329);const o={sidebar_position:5,title:"AWS BYOK - How to create a key on the HSM",sidebar_label:"Create Key on HSM"},l="Create Key on HSM",i={},c=[{value:"Create Key using Primus Tools",id:"create-key-using-primus-tools",level:2},{value:"List Keys on HSM",id:"list-keys-on-hsm",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"create-key-on-hsm",children:"Create Key on HSM"})}),"\n",(0,n.jsx)(t.p,{children:"It is necessary to generate a key on the HSM which will be imported to the AWS KMS. In the below example we create a key using Primus Tools, but a different tool can be used. If you will be using different tools please ensure to create the key with the proper parameters."}),"\n",(0,n.jsx)(t.h2,{id:"create-key-using-primus-tools",children:"Create Key using Primus Tools"}),"\n",(0,n.jsxs)(t.p,{children:["To create a key on the Securosys CloudHSM or PrimusHSM ",(0,n.jsx)(t.code,{children:"primus-tools.jar"})," can be used. It is paramount to set the flag of the import key to extractable. To import the key to AWS KMS the import key algorithm must be symmetric AES with a recommended size of 256 bits. If there is a symmetric AES key with the necessary parameters already prepared, please skip this step."]}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["Ensure that ",(0,n.jsx)(t.code,{children:"primusX.jar"})," is in the same directory as ",(0,n.jsx)(t.code,{children:"primus-tools.jar"})," or the ",(0,n.jsx)(t.code,{children:"PATH"})," or ",(0,n.jsx)(t.code,{children:"CLASSPATH"})," environment variable is set correctly."]})}),"\n",(0,n.jsx)(t.admonition,{type:"warning",children:(0,n.jsx)(t.p,{children:"The Key with the same key name must not exist prior creation!"})}),"\n",(0,n.jsx)(t.p,{children:"The following command sample creates a key on the HSM:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"java -jar primus-tools.jar CreateKey <HSM connection and credentials> \\\n-keyname <keyname> -type AES [-size <size>] \\\n-flags <flags> [-access <access>]\n"})}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Parameter"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"-keyname"})}),(0,n.jsxs)(t.td,{children:["Replace the ",(0,n.jsx)(t.code,{children:"\\<keyname\\>"})," variable with the name of the key to store on the HSM."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"-type"})}),(0,n.jsx)(t.td,{children:"The key type must be AES! (other HSM known key types: RSA, TDEA, DDEA, EC)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"-size"})}),(0,n.jsxs)(t.td,{children:["Replace the ",(0,n.jsx)(t.code,{children:"\\<size\\>"})," variable with the key size of the AES key. The recommended key size is 256."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"-flags"})}),(0,n.jsxs)(t.td,{children:["Replace the ",(0,n.jsx)(t.code,{children:"\\<flags\\>"})," variable with the possible flag variables (separated by a comma): ",(0,n.jsx)(t.code,{children:"sensitive"}),", ",(0,n.jsx)(t.code,{children:"extractable"}),", ",(0,n.jsx)(t.code,{children:"modifiable"}),", ",(0,n.jsx)(t.code,{children:"encrypt"}),", ",(0,n.jsx)(t.code,{children:"decrypt"}),", ",(0,n.jsx)(t.code,{children:"sign"}),", ",(0,n.jsx)(t.code,{children:"verify"}),", ",(0,n.jsx)(t.code,{children:"wrap"}),", ",(0,n.jsx)(t.code,{children:"unwrap"}),". ",(0,n.jsx)("br",{})," The key must be flagged as ",(0,n.jsx)(t.code,{children:"extractable"}),"! ",(0,n.jsx)("br",{})," Flags correspond to the key flags and capabilities described in ",(0,n.jsx)(t.a,{href:"https://support.securosys.com/external/knowledge-base/article/63",children:"Primus HSM User Guide Appendix chapters"}),"."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"-access"})}),(0,n.jsx)(t.td,{children:"Used for EKA/SKA only"})]})]})]}),"\n",(0,n.jsx)(t.p,{children:"Example command:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"java -jar primus-tools.jar CreateKey --host a-api.cloudshsm.com -port 2300 \\\n-user DEMO-TEST -password file:pwsetup \\\n-primusproxyuser FQO...QQOS -primusproxypassword file:pwproxy \\\n -keyname AWS-ByokAES256 -type AES -size 256 -flags extractable,wrap,unwrap\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"CreateKey"})," command does not give any feedback that the key was created. To verify the key creation either check the HSM logs or list the keys."]}),"\n",(0,n.jsx)(t.h2,{id:"list-keys-on-hsm",children:"List Keys on HSM"}),"\n",(0,n.jsx)(t.p,{children:"It is possible to use Primus Tools to list all objects, assigned flags and the first 3 bytes of the SHA256 hash over the symmetric key objects to detect changes on the user partition. The following command sample shows how to do so:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"java -jar primus-tools.jar ListKeyStoreObjcets <HSM connection and credentials> \n[-keysonly] [-prefixes] [-allflags] [-allobjects]\n"})}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Parameter"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"-keysonly"})}),(0,n.jsx)(t.td,{children:"list only keys and no other objects"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"-prefixes"})}),(0,n.jsx)(t.td,{children:"list objects in a parsable format with keywords included"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"-allflags"})}),(0,n.jsx)(t.td,{children:"list all key attributes/flags"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.code,{children:"-allobjects"})}),(0,n.jsx)(t.td,{children:"list all objects (SecretKey, PublicKey, Certificate, \u2026)"})]})]})]}),"\n",(0,n.jsx)(t.p,{children:"Example command of a parsable key listing, including key attributes and hashes for symmetrical keys:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"java -jar primus-tools.jar ListKeyStoreObjects --host a-api.cloudshsm.com -port 2300 \\\n-user DEMO-TEST -password file:pwsetup \\\n-primusproxyuser FQO...QQOS -primusproxypassword file:pwproxy\n-keysonly -prefixes -allflags\n"})}),"\n",(0,n.jsx)(t.p,{children:"Example output:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"ONAME: AWS-ByokAES256 OTYPE: AES KSIZE: 256 OFLAGS: nonsensi-tive,extractable,modifiable,copyable,token,nonindestructible,private,nonpublic,nonneverextracta-ble,nonalwayssensitive,local,encrypt,decrypt,sign,verify,wrap,unwrap,notderive OHASH: 2ECFC2\n"})})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},65537:(e,t,r)=>{r.d(t,{A:()=>w});var s=r(96540),n=r(34164),a=r(65627),o=r(56347),l=r(50372),i=r(30604),c=r(11861),d=r(78749);function u(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:r}=e;return(0,s.useMemo)((()=>{const e=t??function(e){return u(e).map((e=>{let{props:{value:t,label:r,attributes:s,default:n}}=e;return{value:t,label:r,attributes:s,default:n}}))}(r);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function p(e){let{value:t,tabValues:r}=e;return r.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:r}=e;const n=(0,o.W6)(),a=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,i.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(n.location.search);t.set(a,e),n.replace({...n.location,search:t.toString()})}),[a,n])]}function y(e){const{defaultValue:t,queryString:r=!1,groupId:n}=e,a=h(e),[o,i]=(0,s.useState)((()=>function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const s=r.find((e=>e.default))??r[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:t,tabValues:a}))),[c,u]=m({queryString:r,groupId:n}),[y,b]=function(e){let{groupId:t}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,a]=(0,d.Dv)(r);return[n,(0,s.useCallback)((e=>{r&&a.set(e)}),[r,a])]}({groupId:n}),x=(()=>{const e=c??y;return p({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{x&&i(x)}),[x]);return{selectedValue:o,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),b(e)}),[u,b,a]),tabValues:a}}var b=r(9136);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=r(74848);function f(e){let{className:t,block:r,selectedValue:s,selectValue:o,tabValues:l}=e;const i=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),d=e=>{const t=e.currentTarget,r=i.indexOf(t),n=l[r].value;n!==s&&(c(t),o(n))},u=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=i.indexOf(e.currentTarget)+1;t=i[r]??i[0];break}case"ArrowLeft":{const r=i.indexOf(e.currentTarget)-1;t=i[r]??i[i.length-1];break}}t?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.A)("tabs",{"tabs--block":r},t),children:l.map((e=>{let{value:t,label:r,attributes:a}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,ref:e=>{i.push(e)},onKeyDown:u,onClick:d,...a,className:(0,n.A)("tabs__item",x.tabItem,a?.className,{"tabs__item--active":s===t}),children:r??t},t)}))})}function k(e){let{lazy:t,children:r,selectedValue:a}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===a));return e?(0,s.cloneElement)(e,{className:(0,n.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==a})))})}function g(e){const t=y(e);return(0,j.jsxs)("div",{className:(0,n.A)("tabs-container",x.tabList),children:[(0,j.jsx)(f,{...t,...e}),(0,j.jsx)(k,{...t,...e})]})}function w(e){const t=(0,b.A)();return(0,j.jsx)(g,{...e,children:u(e.children)},String(t))}},79329:(e,t,r)=>{r.d(t,{A:()=>o});r(96540);var s=r(34164);const n={tabItem:"tabItem_Ymn6"};var a=r(74848);function o(e){let{children:t,hidden:r,className:o}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(n.tabItem,o),hidden:r,children:t})}}}]);