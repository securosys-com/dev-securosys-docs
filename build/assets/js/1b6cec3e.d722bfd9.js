"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[78243],{6109:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>u,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"Tutorials/KeyAttributes","title":"HSM Key Attributes with JCE/JCA","description":"Access Key Attributes with Java Cryptography Extension (JCE) and Java Cryptography Architecture (JCA) with Securosys Hardware Security Modules.","source":"@site/jce/Tutorials/KeyAttributes.md","sourceDirName":"Tutorials","slug":"/Tutorials/KeyAttributes","permalink":"/jce/Tutorials/KeyAttributes","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"HSM Key Attributes with JCE/JCA","sidebar_label":"Key Attributes","description":"Access Key Attributes with Java Cryptography Extension (JCE) and Java Cryptography Architecture (JCA) with Securosys Hardware Security Modules.","keywords":["hsm","cloud hsm"]},"sidebar":"tutorialSidebar","previous":{"title":"Sign & Verify","permalink":"/jce/Tutorials/SignVerify"},"next":{"title":"Key Enumeration","permalink":"/jce/Tutorials/KeyEnumeration"}}');var r=t(74848),s=t(28453);const a={sidebar_position:2,title:"HSM Key Attributes with JCE/JCA",sidebar_label:"Key Attributes",description:"Access Key Attributes with Java Cryptography Extension (JCE) and Java Cryptography Architecture (JCA) with Securosys Hardware Security Modules.",keywords:["hsm","cloud hsm"]},l="Key Attributes",u={},o=[];function c(e){const i={a:"a",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"key-attributes",children:"Key Attributes"})}),"\n",(0,r.jsx)(i.p,{children:"This code provides a comprehensive demonstration of manipulating key attributes, specifically focusing on capability and access flags within the Securosys Primus HSM JCE provider. It helps illustrate how key capabilities can be controlled and how attempts to perform operations outside the specified capabilities are handled."}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:t(42985).A+"",children:"KeyAttributesSample.java"})}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-java",children:'/*\n * Copyright (C) 2016-2019, Securosys SA\n */\n\nimport java.security.KeyPair;\nimport java.security.KeyPairGenerator;\nimport java.security.Signature;\nimport java.util.UUID;\n\nimport com.securosys.primus.jce.PrimusKeyAttributes;\nimport com.securosys.primus.jce.PrimusProvider;\nimport com.securosys.primus.jce.PrimusProviderException;\n\n/**\n * Sample code manipulating key attributes\n * with the Securosys Primus HSM JCE provider.\n *\n * The sample goes through the following steps:\n * 1) HSM Login\n * 2) Create a key\n * 3) Display default attributes\n * 4) Sign and verify with the key\n * 5) Disable signature and verification with the key\n * 6) Attempt at signature and verification\n * 7) Re-enable the capabilities\n */\npublic class KeyAttributesSample {\n\n    public static void main(final String... args) throws Exception {\n\n        // 1 -- HSM AND PROVIDER CONFIGURATION\n\n        // HSM configuration\n        PrimusHelper.setup(args);\n\n        // 2 -- CREATE A KEY WITH DEFAULT ATTRIBUTES\n\n        System.out.println("creating RSA key pair of 2048 bits ...");\n        final KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA", PrimusProvider.getProviderName());\n        keyPairGenerator.initialize(2048);\n        final KeyPair keyPair = keyPairGenerator.generateKeyPair();\n\n        // 3 -- DISPLAY THE DEFAULT ATTRIBUTES\n\n        // Display default capability and access flags for the private and public keys\n        displayKeyAttributes("default private capability flags:", PrimusKeyAttributes.getKeyCapabilityFlags(keyPair.getPrivate()));\n        displayKeyAttributes("default public capability flags:", PrimusKeyAttributes.getKeyCapabilityFlags(keyPair.getPublic()));\n        displayKeyAttributes("default private access flags:", PrimusKeyAttributes.getKeyAccessFlags(keyPair.getPrivate()));\n        displayKeyAttributes("default public access flags:", PrimusKeyAttributes.getKeyAccessFlags(keyPair.getPublic()));\n\n        // 4 -- USE THE KEY TO SIGN A PAYLOAD AND VERIFY THE SIGNATURE\n\n        System.out.print("signing ...");\n        final Signature signature = Signature.getInstance("SHA256withRSA", PrimusProvider.getProviderName());\n        signature.initSign(keyPair.getPrivate());\n        final byte[] msg = UUID.randomUUID().toString().getBytes();\n        signature.update(msg);\n        byte[] sig = signature.sign();\n        System.out.println(" OK");\n\n        System.out.print("verifying ...");\n        signature.initVerify(keyPair.getPublic());\n        signature.update(msg);\n        System.out.println(signature.verify(sig));\n\n        // 5 -- MODIFY CAPABILITY FLAGS TO DISABLE SIGNATURE AND VERIFICATION WITH THE KEY\n\n        // Disable verification capability for the public key\n        System.out.println("disable verify ...");\n        PrimusKeyAttributes.setKeyCapabilityFlag(keyPair.getPublic(), PrimusKeyAttributes.CAPABILITY_VERIFY, false);\n\n        // Attempt signature with the disabled capability\n        signature.initSign(keyPair.getPrivate());\n        signature.update(msg);\n        sig = signature.sign();\n\n        // 6 -- ATTEMPT AT SIGNATURE AND VERIFICATION\n\n        // Attempt verification with the disabled capability, expect an exception\n        try {\n            signature.initVerify(keyPair.getPublic());\n            signature.update(msg);\n            signature.verify(sig);\n            System.out.println("UNEXPECTED");\n            throw new AssertionError();\n        } catch (PrimusProviderException e) {\n            System.out.println("error verifying as expected: " + e);\n        }\n\n        // Disable signing capability for the private key\n        System.out.println("disable sign ...");\n        PrimusKeyAttributes.setKeyCapabilityFlag(keyPair.getPrivate(), PrimusKeyAttributes.CAPABILITY_SIGN, false);\n\n        // Attempt signature with the disabled capability, expect an exception\n        try {\n            signature.initSign(keyPair.getPrivate());\n            signature.update(msg);\n            sig = signature.sign();\n            System.out.println("UNEXPECTED");\n            throw new AssertionError();\n        } catch (PrimusProviderException e) {\n            System.out.println("error signing as expected: " + e);\n        }\n\n        // 7 - RE-ENABLE THE CAPABILITIES\n\n        // Re-enable signing and verification capabilities for both private and public keys\n        System.out.println("reenable signing and verification capability...");\n        PrimusKeyAttributes.setKeyCapabilityFlag(keyPair.getPublic(), PrimusKeyAttributes.CAPABILITY_VERIFY, true);\n        PrimusKeyAttributes.setKeyCapabilityFlag(keyPair.getPrivate(), PrimusKeyAttributes.CAPABILITY_SIGN, true);\n\n        // Perform signing and verification again\n        signature.initSign(keyPair.getPrivate());\n        signature.update(msg);\n        sig = signature.sign();\n\n        signature.initVerify(keyPair.getPublic());\n        signature.update(msg);\n        signature.verify(sig);\n\n        System.out.println("signature and verification successful");\n    }\n\n    // Helper method to display key attributes\n    private static void displayKeyAttributes(String label, int flags) {\n        System.out.print(label);\n        for (int f = 1; f <= flags; f <<= 1) {\n            if ((flags & f) != 0) {\n                System.out.print(" " + PrimusKeyAttributes.getCapabilityFlagName(f));\n            }\n        }\n        System.out.println();\n    }\n}\n'})}),"\n",(0,r.jsx)(i.p,{children:"Explanation:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"HSM and Provider Configuration:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["The Primus HSM and provider are configured using ",(0,r.jsx)(i.code,{children:"PrimusHelper.setup(args)"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Create a Key with Default Attributes:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"An RSA key pair is generated with a key size of 2048 bits."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Display Default Attributes:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"The default capability and access flags for both private and public keys are displayed."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Use the Key to Sign a Payload and Verify the Signature:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"A random payload is signed using the private key, and the signature is verified using the public key."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Modify Capability Flags to Disable Signature and Verification:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Capability flags are modified to disable signature and verification for the key."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Attempt at Signature and Verification:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"An attempt is made to sign and verify using the disabled capabilities, resulting in expected exceptions."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Re-enable the Capabilities:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"The capabilities for signing and verification are re-enabled for both private and public keys."}),"\n",(0,r.jsx)(i.li,{children:"Signing and verification operations are performed again, demonstrating the re-enabled capabilities."}),"\n"]}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453:(e,i,t)=>{t.d(i,{R:()=>a,x:()=>l});var n=t(96540);const r={},s=n.createContext(r);function a(e){const i=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(s.Provider,{value:i},e.children)}},42985:(e,i,t)=>{t.d(i,{A:()=>n});const n=t.p+"assets/files/KeyAttributesSample-fe78d1b5ea02a491eeaf2177fc187aae.java"}}]);