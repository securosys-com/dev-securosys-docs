"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[21341],{28453:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>a});var i=r(96540);const s={},n=i.createContext(s);function o(e){const t=i.useContext(n);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(n.Provider,{value:t},e.children)}},50426:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"Use-Cases/Certutil","title":"Using Certutil with an HSM","description":"Securing Microsoft Certutil with Securosys Hardware Security Modules (HSMs)","source":"@site/mscng/Use-Cases/Certutil.md","sourceDirName":"Use-Cases","slug":"/Use-Cases/Certutil","permalink":"/mscng/Use-Cases/Certutil","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":0,"frontMatter":{"sidebar_position":0,"title":"Using Certutil with an HSM","sidebar_label":"Certutil","description":"Securing Microsoft Certutil with Securosys Hardware Security Modules (HSMs)","keywords":["hsm","cloud hsm"]},"sidebar":"tutorialSidebar","previous":{"title":"Use Cases","permalink":"/mscng/category/use-cases"},"next":{"title":"CSR request with Certreq","permalink":"/mscng/Use-Cases/certificate-request"}}');var s=r(74848),n=r(28453);const o={sidebar_position:0,title:"Using Certutil with an HSM",sidebar_label:"Certutil",description:"Securing Microsoft Certutil with Securosys Hardware Security Modules (HSMs)",keywords:["hsm","cloud hsm"]},a=void 0,c={},l=[{value:"List Keys",id:"list-keys",level:2},{value:"Delete a Key",id:"delete-a-key",level:2},{value:"Restore a key",id:"restore-a-key",level:2},{value:"Sign Data Using an HSM Key",id:"sign-data-using-an-hsm-key",level:2},{value:"Import a Certificate into the HSM",id:"import-a-certificate-into-the-hsm",level:2},{value:"Export a Certificate and Private Key from the HSM",id:"export-a-certificate-and-private-key-from-the-hsm",level:2},{value:"Testing CA service",id:"testing-ca-service",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["Using ",(0,s.jsx)(t.code,{children:"certutil"})," it is possible to manage existing keys, certificates, signing, encryption, and HSM-backed operations securely. This utility helps integrate HSM-based security into Windows environments, ensuring cryptographic integrity and compliance."]}),"\n",(0,s.jsxs)(t.p,{children:["Below we provide certain use cases for the certutil. For more information on the commands and their parameters please see ",(0,s.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/certutil",children:"Microsoft Certutil Documentation"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"list-keys",children:"List Keys"}),"\n",(0,s.jsx)(t.p,{children:"Retrieves all keys stored inside the HSM."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'certutil -csp "Securosys Primus HSM Key Storage Provider" -key -user\n'})}),"\n",(0,s.jsx)(t.h2,{id:"delete-a-key",children:"Delete a Key"}),"\n",(0,s.jsx)(t.p,{children:"Securely removes a cryptographic key from the HSM."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'certutil -delkey -csp "Securosys Primus HSM Key Storage Provider" <KeyName>\n'})}),"\n",(0,s.jsx)(t.h2,{id:"restore-a-key",children:"Restore a key"}),"\n",(0,s.jsxs)(t.p,{children:["Restore a exported ",(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:".pfx"})})," file to restore it under the original private key name by running the following command:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"certutil -restorekey <myDemoCAPrimus>.p12\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"replace the example key name with your own."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"sign-data-using-an-hsm-key",children:"Sign Data Using an HSM Key"}),"\n",(0,s.jsx)(t.p,{children:"Digitally signs data with a private key stored inside the Securosys HSM."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'certutil -csp "Securosys Primus HSM Key Storage Provider" -sign -user <InputFile> <SignatureFile> "<CertificateName>"\n'})}),"\n",(0,s.jsx)(t.h2,{id:"import-a-certificate-into-the-hsm",children:"Import a Certificate into the HSM"}),"\n",(0,s.jsx)(t.p,{children:"To import a certificate into the Securosys HSM, execute the command:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'certutil -f -v [-p "<passphrase>"] -csp "Securosys Primus HSM Key Storage Provider" -importpfx <myBackupFolder>\\<myCAPrivateKeyBackup>.p12 [FriendlyName="<myCAName>",KeyFriendlyName="<myCAName>",NoExport|ExportEncrypted]\n'})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["replace the example parameters and the brackets (",(0,s.jsx)(t.code,{children:"<>"}),") with your own."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"export-a-certificate-and-private-key-from-the-hsm",children:"Export a Certificate and Private Key from the HSM"}),"\n",(0,s.jsx)(t.p,{children:"Use the following command to export the certificate and its private key:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"certutil -exportpfx <myStore> <myDemoCA> <myDemoCAPrimus>.p12\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"replace the example parameters and with your own."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"testing-ca-service",children:"Testing CA service"}),"\n",(0,s.jsx)(t.p,{children:"Run the following command to verify the CA service is up and ready to receive requests:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'certutil -ping\n\nConnecting to WIN\\<myDemoCA> ...\nServer "<myDemoCA>" ICertRequest2 interface is alive (32ms)\n'})})]})}function u(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);