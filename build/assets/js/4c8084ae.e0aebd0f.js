"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[91090],{28453:(e,r,i)=>{i.d(r,{R:()=>o,x:()=>c});var n=i(96540);const t={},s=n.createContext(t);function o(e){const r=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(s.Provider,{value:r},e.children)}},43697:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"Tutorials/Migrating-MPKI-to-HSM/Reconfigure-ADCS-Registry","title":"Reconfiguring Microsoft AD CS Registry","description":"Reconfiguring Microsoft AD CS Registry for Securosys Hardware Security Modules (HSMs)","source":"@site/ms-pki-adcs/Tutorials/Migrating-MPKI-to-HSM/Reconfigure-ADCS-Registry.md","sourceDirName":"Tutorials/Migrating-MPKI-to-HSM","slug":"/Tutorials/Migrating-MPKI-to-HSM/Reconfigure-ADCS-Registry","permalink":"/ms-pki-adcs/Tutorials/Migrating-MPKI-to-HSM/Reconfigure-ADCS-Registry","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Reconfiguring Microsoft AD CS Registry","sidebar_label":"Reconfigure registry","description":"Reconfiguring Microsoft AD CS Registry for Securosys Hardware Security Modules (HSMs)","keywords":["hsm","cloud hsm"]},"sidebar":"tutorialSidebar","previous":{"title":"Import a private key","permalink":"/ms-pki-adcs/Tutorials/Migrating-MPKI-to-HSM/Import-PrivKey-toHSM"},"next":{"title":"Testing","permalink":"/ms-pki-adcs/Tutorials/Migrating-MPKI-to-HSM/Test&Cleanup"}}');var t=i(74848),s=i(28453);const o={sidebar_position:4,title:"Reconfiguring Microsoft AD CS Registry",sidebar_label:"Reconfigure registry",description:"Reconfiguring Microsoft AD CS Registry for Securosys Hardware Security Modules (HSMs)",keywords:["hsm","cloud hsm"]},c="Reconfiguring the Microsoft AD CS Registry",l={},a=[{value:"Migrating from Microsoft CNG/KSP",id:"migrating-from-microsoft-cngksp",level:2},{value:"Migrating from CSP",id:"migrating-from-csp",level:2}];function d(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"reconfiguring-the-microsoft-ad-cs-registry",children:"Reconfiguring the Microsoft AD CS Registry"})}),"\n",(0,t.jsx)(r.p,{children:"Depending on the \u201cSource\u201d key store, the procedure differs slightly (CNG 2.8.4.1, CSP 2.8.4.2)."}),"\n",(0,t.jsx)(r.h2,{id:"migrating-from-microsoft-cngksp",children:"Migrating from Microsoft CNG/KSP"}),"\n",(0,t.jsx)(r.p,{children:"This step applies only in case you migrated from a CNG-based key store (e.g. MS Software KSP)."}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Open a Command Shell with administrator rights"}),"\n",(0,t.jsxs)(r.li,{children:["Edit the previously exported registry file ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"myCACSPregistry.reg"})})," by replacing the Provider value with the Primus HSM CNG/KSP provider name (default ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"Securosys Primus HSM Key Storage Provider"})}),"; can be shown with the command ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"certutil -csplist"})}),"):"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'Windows Registry Editor Version 5.00\n\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\CertSvc\\Configuration\\myDemoCA\\CSP]\n"ProviderType"=dword:00000000\n"Provider"="Securosys Primus HSM Key Storage Provider"\n"HashAlgorithm"=dword:ffffffff\n"CNGPublicKeyAlgorithm"="RSA"\n"CNGHashAlgorithm"="SHA256"\n"MachineKeyset"=dword:00000001\n'})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Save the file and run it to import the registry values."}),"\n",(0,t.jsxs)(r.li,{children:["Repeat the same procedure with the other exported registry file ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"myCAEncryptionCSPregistry.reg"})}),"."]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"migrating-from-csp",children:"Migrating from CSP"}),"\n",(0,t.jsx)(r.p,{children:"This step applies only in case you migrate from a CSP-based key store (e.g. Microsoft Strong Cryptographic Provider)."}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Open a Command Shell with administrator rights"}),"\n",(0,t.jsxs)(r.li,{children:["Edit the previously exported registry file ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"myCACSPregistry.reg"})})," by replacing the Provider value with the Primus HSM CNG/KSP provider name and adapt/add all the other values marked in red:"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'Windows Registry Editor Version 5.00\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\CertSvc\\Configuration\\myDemoCA\\CSP]\n"ProviderType"=dword:00000000\n"Provider"="Securosys Primus HSM Key Storage Provider"\n"CNGPublicKeyAlgorithm"="RSA"\n"CNGHashAlgorithm"="SHA1"\n"MachineKeyset"=dword:00000001\n'})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Execute the following command to evaluate the previously used CSP hash algorithm:"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"certutil -v -getreg ca\\csp\\HashAlgorithm\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\CertSvc\\Configuration\\myDemoCA\\csp:\n\n  HashAlgorithm REG_DWORD = 8004 (32772)\n    CALG_SHA1\n    Algorithm Class: 0x8000(4) ALG_CLASS_HASH\n    Algorithm Type: 0x0(0) ALG_TYPE_ANY\n    Algorithm Sub-id: 0x4(4) ALG_SID_SHA1\nCertUtil: -getreg command completed successfully.\n"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["And adapt the above file ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"myCACSPregistry.reg"})})," on the line with the CNGHashAlgorithm inserting the proper hash algorithm for CNG (in this case \u201cSHA1\u201d)."]}),"\n",(0,t.jsx)(r.li,{children:"Save the file and run it to import the registry values."}),"\n",(0,t.jsxs)(r.li,{children:["Edit the previously exported registry file ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"myCAEncryptionCSPregistry.reg"})})," by replacing the Provider value with the Primus HSM CNG/KSP provider name and adapt/add all the other values marked in red:"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'Windows Registry Editor Version 5.00\n\n[HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\CertSvc\\Configuration\\myDemoCA\\EncryptionCSP]\n"ProviderType"=dword:00000000\n"Provider"="Securosys Primus HSM Key Storage Provider"\n"CNGPublicKeyAlgorithm"="RSA"\n"CNGEncryptionAlgorithm"="3DES"\n"MachineKeyset"=dword:00000001\n"SymmetricKeySize"=dword:000000a8\n'})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Execute the following command to evaluate the previously used CSP encryption algorithm:"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"certutil -v -getreg ca\\encryptioncsp\\EncryptionAlgorithm\n\nHKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\CertSvc\\Configuration\\myDemoCA\\encryptioncsp:\n\n  EncryptionAlgorithm REG_DWORD = 6603 (26115)\n    CALG_3DES\n    Algorithm Class: 0x6000(3) ALG_CLASS_DATA_ENCRYPT\n    Algorithm Type: 0x600(3) ALG_TYPE_BLOCK\n    Algorithm Sub-id: 0x3(3) ALG_SID_3DES\nCertUtil: -getreg command completed successfully.\n"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["And adapt the above file ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"myCAEncryptionCSPregistry.reg"})})," on the line with ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"CNGEncryptionAlgorithm"})}),", inserting the proper encryption algorithm for CNG (in this case ",(0,t.jsx)(r.em,{children:"3DES"}),"), and the proper value for SymmetricKeySize (hexadecimal value, in this case is ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"000000a8 = 168"})}),")."]}),"\n",(0,t.jsxs)(r.li,{children:["Save the file and run it to import the registry values.\nIn case you want to change the hash algorithm from ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"SHA1"})})," to ",(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.code,{children:"SHA256"})}),", consult the Microsoft documentation mentioned at ",(0,t.jsx)(r.a,{href:"/ms-pki-adcs/Tutorials/Migrating-MPKI-to-HSM/Migrating-MPKI-toHSM",children:"Migrating Microsoft PKI"})]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);