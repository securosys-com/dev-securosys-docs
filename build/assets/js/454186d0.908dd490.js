"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[83705],{28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>l});var r=s(96540);const n={},i=r.createContext(n);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(i.Provider,{value:t},e.children)}},36434:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/files/sign_timestamp_rsa-af61292c6a378bae27e6a636e7ccb437.sh"},53741:(e,t,s)=>{s.d(t,{A:()=>r});const r=s.p+"assets/files/sign_rsa-df56d64d5c182d5ffd353cfe1f30bec6.sh"},63693:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"Tutorials/TransactionSecurityBroker/samples/step-by-step/signature-request","title":"Create a Authorized Signature Request","description":"Issue a Signature Request","source":"@site/tsb/Tutorials/TransactionSecurityBroker/samples/step-by-step/signature-request.md","sourceDirName":"Tutorials/TransactionSecurityBroker/samples/step-by-step","slug":"/Tutorials/TransactionSecurityBroker/samples/step-by-step/signature-request","permalink":"/tsb/Tutorials/TransactionSecurityBroker/samples/step-by-step/signature-request","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Create a Authorized Signature Request","sidebar_label":"2. Create a Authorized Signature-Request"},"sidebar":"tutorialSidebar","previous":{"title":"1. Create Policy based key","permalink":"/tsb/Tutorials/TransactionSecurityBroker/samples/step-by-step/create-policy-based-key"},"next":{"title":"More Request Samples","permalink":"/tsb/Tutorials/TransactionSecurityBroker/samples/multi-authorization-samples"}}');var n=s(74848),i=s(28453),a=s(65537),l=s(79329);const o={sidebar_position:2,title:"Create a Authorized Signature Request",sidebar_label:"2. Create a Authorized Signature-Request"},d=void 0,c={},h=[{value:"Issue a Signature Request",id:"issue-a-signature-request",level:3},{value:"Fetch an approval task",id:"fetch-an-approval-task",level:3},{value:"Send Approval",id:"send-approval",level:3},{value:"Get the approved signature",id:"get-the-approved-signature",level:3}];function u(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components},{Details:r,Icon:o}=t;return r||g("Details",!0),o||g("Icon",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h3,{id:"issue-a-signature-request",children:"Issue a Signature Request"}),"\n",(0,n.jsx)(t.admonition,{title:"Create RSA Approval Key",type:"tip",children:(0,n.jsxs)(t.p,{children:["This example shows how to create a signature request that requires approval based on the key policy rule ",(0,n.jsx)(t.code,{children:"ruleUse."})," Since the key is an SKA key (a key with a policy), the request isn't executed immediately and must be ",(0,n.jsx)(t.strong,{children:"approved"})," by the designated approver ",(0,n.jsx)(t.code,{children:"approverx."})]})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"POST"})," ",(0,n.jsx)(t.a,{href:"https://tsb-demo.cloudshsm.com/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config#/Requests/sign",children:"/v1/sign"})]}),"\n",(0,n.jsxs)(a.A,{groupId:"key-provider",children:[(0,n.jsx)(l.A,{value:"Commented",label:"Commented",default:!0,children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'{\n  "signRequest": {\n    "payload": "QXBwcm92ZVNpZ25UYXNrUGF5bG9hZA==",     # base64 encoded payload\n    "payloadType": "UNSPECIFIED",\n    "signKeyName": "TSB_TUTORIAL_1-RSA", # adjust the keyname to your previously created key defined as `label` in POST: /v1/key\n    "signatureAlgorithm": "SHA256_WITH_RSA"\n  }\n}\n'})})}),(0,n.jsx)(l.A,{value:"Un-commented",label:"Un-commented",default:!0,children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'{\n  "signRequest": {\n    "payload": "QXBwcm92ZVNpZ25UYXNrUGF5bG9hZA==",\n    "payloadType": "UNSPECIFIED",\n    "signKeyName": "TSB_TUTORIAL_1-RSA",\n    "signatureAlgorithm": "SHA256_WITH_RSA"\n  }\n}\n'})})})]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Response:"})," Status: 201"]}),"\n",(0,n.jsx)(t.admonition,{title:"Interpreting the response",type:"warning",children:(0,n.jsxs)(t.p,{children:["The response is not the actual signature, rather an ",(0,n.jsx)(t.strong,{children:"uuid"})," you will use in the final step, once the quorum is met and all approvals have been given.\nThe uuid should be stored in the business app."]})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'{\n  "signRequestId": "4e8731d8-0ae6-4444-8a8c-b73ab5f0ba18"    \n}\n'})}),"\n",(0,n.jsx)(t.h3,{id:"fetch-an-approval-task",children:"Fetch an approval task"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(o,{icon:"fa-solid fa-triangle-exclamation",size:"lg"})," To approve the original sign request, the approver has to fetch and solve a challenge first. ",(0,n.jsx)(o,{icon:"fa-solid fa-triangle-exclamation",size:"lg"})]}),"\n",(0,n.jsxs)(t.admonition,{title:"Fetch Approval Task",type:"tip",children:[(0,n.jsxs)(t.p,{children:["The script ",(0,n.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(36434).A+"",title:"sign_timestamp_rsa.sh",children:"Sign Timestamp"}),"  signs the current Timestamp of the system ",(0,n.jsx)(t.code,{children:'"timestamp": "2023-10-30T17:30:24+00:00",'})," with the approvers private key and generates a request-body to be sent to TSB."]}),(0,n.jsxs)(t.p,{children:["Run: ",(0,n.jsx)(t.code,{children:"./sign_timestamp_rsa.sh approverx"})]}),(0,n.jsxs)(t.p,{children:["The output of the script should be sent to the endpoint: ",(0,n.jsx)(t.code,{children:"/v1/filteredSignApprovalTask"})," to fetch the challenge",(0,n.jsx)("br",{})]})]}),"\n",(0,n.jsx)(t.admonition,{title:"Prove",type:"note",children:(0,n.jsxs)(t.p,{children:["In order to receive the challenge for a specific approver, one must ",(0,n.jsx)(t.strong,{children:"prove"})," that he possess the approver's private key.\nThe prove is given by signing the ",(0,n.jsx)(t.em,{children:"current timestamp"}),", doing this introduces a mitigation to prevent replay attacks."]})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"POST"})," ",(0,n.jsx)(t.a,{href:"https://tsb-demo.cloudshsm.com/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config#/Approval%20Tasks/filterSignTasks",children:"/v1/filteredSignApprovalTask"})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'{\n  "timestamp": "2023-10-30T17:30:24+00:00",\n  "timestampSignature": "VuZ0f/VEM2iq0zGCAVFTgWWD5zLJGCtUs/Eh3ecz4lYXSU42TwTWjwL6EQ4SHXf2gYZoci5q5nwswxkd0i4gvQ5fKd3lM8RzleDUziWqicrak65guIKynYuOvvYE29yqkwQ20N4FTKHAoseokIch8ByhxTeURFAinWHJZ9Rhf9ShojGn5f5/sP6G8C7WHMOaOB7f5e+FrjRfQs660rVaVjQU6XKmRrtKHsQQcMTz2Npm4/ikBolVSUXV4ZWUofA8ZR3+/aBsINw/CALnNIp+9mU6WEbneRz6nK1/LWV/VMT8A9J4gEo8GIGGSCFWlbq2P6DxTxLSHByEiNelYxOkqA==",\n  "approverCertificate": "MIIDUTCCAjmgAwIBAgIUVyyrH8t8ldAUzHaYAyavN7mK6lMwDQYJKoZIhvcNAQELBQAwODELMAkGA1UEBhMCQ0gxDTALBgNVBAoMBFRlc3QxGjAYBgNVBAMMEVNLQSBUZXN0IDIwMjMgUlNBMB4XDTIzMTAzMDE1MjIxMFoXDTI0MTAyOTE1MjIxMFowODELMAkGA1UEBhMCQ0gxDTALBgNVBAoMBFRlc3QxGjAYBgNVBAMMEVNLQSBUZXN0IDIwMjMgUlNBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuUy1tRrrO5xf6576qAJlLHX3HLGP7AKLfHW0TRGXfLP+ngFiSF4qAQdeU7rDtoY0QbjPazqFr8E9wuvjZX4B8xDEPPlECEO+7ixmeb0CX1HtZrES4b9CJuYunBl/ENNujnXH0pE9yw5/SiIxujISyNZmorDIurMsi7JYreq3ZOj8IisMDHVNfJKPV4QMOWKGtUfj/s7EdQ9H6pEvZcmy/Z9PyYWSCDcID4lrMg/FfdZRwvp9OcouypKOoDKf0pK2K0eYZQtnLZzHA+KI3xTjrpRFHtfufnKd9hozndp3OkZv8ZJFfjJ55RXL1K/ZqHSNSsmOxcGzzfNwI0+S/BjYtQIDAQABo1MwUTAdBgNVHQ4EFgQU261gJf0Ta1kqLevzofEU/vqbY9MwHwYDVR0jBBgwFoAU261gJf0Ta1kqLevzofEU/vqbY9MwDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAbjTisq3rwCcomv4BD2j0DFm+pS3uUDFgGkOci93XSq89rJaWw4mUcQDhdU8rXjm5hNT+XoPND80sv/LwnCVUAXmhGiwwjXNcIORje+5z/Wys+jmPfOrfrzOaoOQEFw5ZQY3SgSQaEN+pmQr4HhorGnlY8aWIQ5XEgx7scebRQI6xx8zeQID20IJTElHby5haCdtaAO9BR+E3U6NnPyr9gFDn0YAf/OfadpaI1beu5TBBj5k9e7+Yzidp+BboolWhvPLSoMlmrTlgwl6Tub/ZQdAelUD0sks5hqZbCjO1/FPIrDgRP57pUw3+EKbDwfpaIOdQGMjr4I/+nAPuWd5s1A==",\n  "timestampDigestAlgorithm": "SHA-256",\n  "detailLevel": "level1",\n  "paging": {\n    "pageNumber": 0,\n    "pageSize": 1,\n    "sortOrder": "CREATION_DATE_ASC"\n  }\n}\n'})}),"\n",(0,n.jsxs)(r,{children:[(0,n.jsx)("summary",{children:"Request Parameters"}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Parameter"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"timestamp"})}),(0,n.jsx)(t.td,{children:"The ISO-8601 formatted timestamp that has been signed by the approval client."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"timestampSignature"})}),(0,n.jsxs)(t.td,{children:["The signature ",(0,n.jsx)(t.strong,{children:"(base64 encoded)"})," for the timestamp (ISO-8601) that was done using the key of the approver. Format of the signature is depending on the algorithm used and as returned when using a JDK's native Signature.sign() method. ",(0,n.jsx)("br",{}),(0,n.jsx)("br",{})," ",(0,n.jsx)(t.code,{children:'TIMESTAMP=$(date -u "+%Y-%m-%dT%H:%M:%S+00:00")'})," ",(0,n.jsx)("br",{})," ",(0,n.jsx)(t.code,{children:"SIGNATURE=$(echo -n $TIMESTAMP | openssl dgst -sha256 -sign $PRIVATE_KEY_NAME | openssl enc -base64 | tr -d '\\n')"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"approverCertificate"})}),(0,n.jsxs)(t.td,{children:["Certificate of the approver in DER format ",(0,n.jsx)(t.strong,{children:"(base64 encoded)"}),". Either the ",(0,n.jsx)(t.code,{children:"approverPublicKey"})," or the ",(0,n.jsx)(t.code,{children:"approverCertificate"})," has to be provided if the ",(0,n.jsx)(t.code,{children:"timestampSigningCertificate"})," is not set."]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"timestampDigestAlgorithm"})}),(0,n.jsxs)(t.td,{children:["The message digest algorithm that was used for computing the timestamp signature. ",(0,n.jsx)(t.code,{children:"SHA-224, SHA-256, SHA-384, SHA-512, SHA3-224, SHA3-256, SHA3-384, SHA3-512"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"id"})}),(0,n.jsx)(t.td,{children:"If specified filters for a specific task id."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"requestId"})}),(0,n.jsx)(t.td,{children:"If specified filters for a specific request id by approver Public Key. Request ID is ignored if task ID is set."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"detailLevel"})}),(0,n.jsxs)(t.td,{children:["The detail level of the response. ",(0,n.jsx)(t.code,{children:"level1, level2, level3, level4, level5"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"pageNumber"})}),(0,n.jsx)(t.td,{children:"The number of the pages of results to be returned."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"pageSize"})}),(0,n.jsx)(t.td,{children:"The number of results (approval tasks) to be returned per page"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"sortOrder"})}),(0,n.jsxs)(t.td,{children:["Sort order of the results. Note: initial value for LAST_FETCHED_DATE is the creation date of the task. LAST_FETCHED_DATE is updated every time a task is returned to the client using the appropriate REST service. ",(0,n.jsx)(t.code,{children:"CREATION_DATE_ASC, CREATION_DATE_DESC, LAST_FETCHED_DATE_ASC, LAST_FETCHED_DATE_DESC"})]})]})]})]})]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Response:"})," Status: 200, with detail-level: ",(0,n.jsx)(t.code,{children:"level1"})," contains a minimal challenge (approval task)"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Body:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:"{6}",children:'{\n  "tasks": [\n    {\n      "detailLevel": "level1",\n      "id": "6947856a-e3a1-44cf-bb99-bbd2995642ca",     # the id of the challenge\n      "approvalToBeSigned": "4AAAADsABAABAAAAAhASAFRTQl9UVVRPUklBTF8xLVJTQQAAVBBAADwAAABXEBYAQXBwcm92ZVNpZ25UYXNrUGF5bG9hZAAABwEIANcU814AAAAAAhANAHRpbWVzdGFtcC1rZXkAAABWEFkAMFcwDAYIKoZIzj0EAwIFAANHADBEAiADPniQDGELMUTqJCJ17kW3bUInXIf8dy9mwsseJ7voJAIgK3Kh4JjkR+RDugYKlp4x3M6UQIXkyQ5OuavkL0V5b5sAAABXEBYAQXBwcm92ZVNpZ25UYXNrUGF5bG9hZAAA"\n                                                        # the challenge payload (challenge to be signed)\n    }\n  ]\n}\n'})}),"\n",(0,n.jsxs)(r,{children:[(0,n.jsx)("summary",{children:"Response Parameters"}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Parameter"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"id"})}),(0,n.jsx)(t.td,{children:"The id of the challenge"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"approvalToBeSigned"})}),(0,n.jsx)(t.td,{children:"The challenge (payload) to be signed with the approvers private key"})]})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"send-approval",children:"Send Approval"}),"\n",(0,n.jsxs)(t.p,{children:["This step signs the challenge (",(0,n.jsx)(t.code,{children:"approvalToBeSigned"})," from the previous step) and herewith authorizes the signature-request."]}),"\n",(0,n.jsxs)(t.admonition,{title:"Fetch Approval Task",type:"tip",children:[(0,n.jsxs)(t.p,{children:["The script ",(0,n.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(53741).A+"",title:"sign_rsa.sh",children:"Sign Approval Challenge"}),"  signs the ",(0,n.jsx)(t.code,{children:"approvalToBeSigned"})," from the previous step, with the approvers private key. Again use the following script to generate the next request body."]}),(0,n.jsxs)(t.p,{children:["Run: ",(0,n.jsx)(t.code,{children:"./sign_rsa.sh approverx 6947856a-e3a1-44cf-bb99-bbd2995642ca 4AAAADsA....F5bG9hZAAA"})]}),(0,n.jsxs)(t.p,{children:["The output of the script should be sent to the endpoint: ",(0,n.jsx)(t.code,{children:"/v1/approval"})," to submit the approval."]})]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"POST"})," ",(0,n.jsx)(t.a,{href:"https://tsb-demo.cloudshsm.com/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config#/Approval%20Tasks/approveTask",children:"/v1/approval"})]}),"\n",(0,n.jsxs)(t.p,{children:["Example request-body, make sure you are replacing the ",(0,n.jsx)(t.code,{children:"id"}),", ",(0,n.jsx)(t.code,{children:"approvalToBeSigned"})," and the ",(0,n.jsx)(t.code,{children:"signature"})," according to above scripts output."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:"{2,3,4}",children:'{\n  "id": "6947856a-e3a1-44cf-bb99-bbd2995642ca",                                 \n  "approvalToBeSigned": "4AAAADsABAABAAAAAhASAFRTQl9UVVRPUklBTF8xLVJTQQAAVBBAADwAAABXEBYAQXBwcm92ZVNpZ25UYXNrUGF5bG9hZAAABwEIANcU814AAAAAAhANAHRpbWVzdGFtcC1rZXkAAABWEFkAMFcwDAYIKoZIzj0EAwIFAANHADBEAiADPniQDGELMUTqJCJ17kW3bUInXIf8dy9mwsseJ7voJAIgK3Kh4JjkR+RDugYKlp4x3M6UQIXkyQ5OuavkL0V5b5sAAABXEBYAQXBwcm92ZVNpZ25UYXNrUGF5bG9hZAAA",                                \n  "signature": "Mn/DQgm2yQbmFgcsEB+v3ACJgIbVo6IFSa7bDfMXmQXJZU21lVE0Bv46dTN6D4oWU/LYTuUYcIXmmRMChVgvRQvF254CctvDww99/ZUB+RrJ5LKE4t4gbHMgORntY/u3lM1CtmD5LwxONcB+3FwIyiODGPiDtfabgAucoGQ1X3Gdvn6KuESfFxtQfr3yn/FcMHBCGZDPPCIDDRaql3u9rI81emhyh7Oi1iXEypHAi9jzAUWRjnFCFtbOOs5MERN+54HxZF8wfY58aZLlHPF0GIhpC9+92NS7GRe0oO+gwlYX43NvewHwitTUMBE0ctd5xoNDkhuu8zMPTJJwiHqbmA==",\n  "approvalDigestAlgorithm": "SHA-256",\n  "approverCertificate":"MIIDAjCCAeoCCQCcSLgNCjDsRzANBgkqhkiG9w0BAQsFADBDMQswCQYDVQQGEwJDSDEPMA0GA1UECAwGWnVyaWNoMQ8wDQYDVQQHDAZadXJpY2gxEjAQBgNVBAoMCVNlY3Vyb3N5czAeFw0yMDA1MTExNDI5MDdaFw0yMTA1MTExNDI5MDdaMEMxCzAJBgNVBAYTAkNIMQ8wDQYDVQQIDAZadXJpY2gxDzANBgNVBAcMBlp1cmljaDESMBAGA1UECgwJU2VjdXJvc3lzMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArA0bxSqhL7xfvcHbKKa8wMTMsIeJfYRdIgPxp5cU9JcmV86kyfpyRcSNSi44LVeNmAi94F3OZrXXi6CZvWrFL+VcewUtUSu+kG5oLJ9T4O6R2I5GO2Ev1HJnK3WfHOsFKFxLGzmKyjEkSLGgopY+Nh74K8Q6yxsvQPETOs9TzQiUXFYlfEZnbjUWG4eAgW9WWEopmK/X295ToOuTHFzmzO00btkjAy6vwWOabCE4kaJg+bCNW1snZz84uonr60rB9H0Mj98RbTfbDyMh6cIkaj8WrXeaYh4fxQYXApYu3nzhe3Q1bNCzV5M68rCsgVrmWcK/xUhM9BK6QHSwS/l76wIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQBNmg+gx2mH+fkU/dtM+tDvMIj2SY4pNU8H144aRY9I5kARN7Uwp+zRfJC+rCxrrYxXmx/OD+mIrTAHxPd5WuUWgULB6DXPho5Tyl4Czt6qOuzl7Qp7n1G9R/evZCPyEHflcGVEko/uCL5N8Ch9YboW5QwTrdftnL+zLLC5nON7KUCqbtVrDSdeMKF+dHKTX4Z90gdbv1C8x1fMWrsaoNw194DNBZCTVe4Di69xz3lHNEWVZ460mqKg0n5010VfEQqA92ceNJhjl4hgNMH9+asdBVAWmt0gk4PJUbqtuOKGKyxqi2k9QX8N2tjlsuMJmwRIw2YsZN4EKqQZ+0NAn1N7"                                \n}\n'})}),"\n",(0,n.jsxs)(r,{children:[(0,n.jsx)("summary",{children:"Request Parameters"}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Parameter"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"id"})}),(0,n.jsx)(t.td,{children:"Id of the task for which the approval is being submitted."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"approvalToBeSigned"})}),(0,n.jsxs)(t.td,{children:["The approval token ",(0,n.jsx)(t.strong,{children:"(base64 encoded)"})," as received from the previous request ",(0,n.jsx)(t.strong,{children:"or constructed by the client"})," using additional data received in the task"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"signature"})}),(0,n.jsxs)(t.td,{children:["The signature of the approvalToBeSigned ",(0,n.jsx)(t.strong,{children:"(base64 encoded)"}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{})," ",(0,n.jsx)(t.code,{children:"SIGNATURE=$(echo -n $APPROVAL_TO_BE_SIGNED | openssl enc -base64 -d -A | openssl dgst -sha256 -sign rsa-private-key.pem | openssl enc -base64 | tr -d '\\n')"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"approvalDigestAlgorithm"})}),(0,n.jsxs)(t.td,{children:["The digest algorithm used for signing the approvalToBeSigned. The signature algorithm is given by the approver's private key. ",(0,n.jsx)(t.code,{children:"SHA-224, SHA-256, SHA-384, SHA-512, SHA3-224, SHA3-256, SHA3-384, SHA3-512"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"approverPublicKey"})}),(0,n.jsxs)(t.td,{children:["If approver is public key based: The public key of the approver in the same format as provided during key creation ",(0,n.jsx)(t.strong,{children:"(base64 encoded)"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"approverCertificate"})}),(0,n.jsxs)(t.td,{children:["If approver is certificate based: The certificate of the approver in the same format as provided during key creation (",(0,n.jsx)(t.strong,{children:"base64 encoded)"})]})]})]})]})]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Response"})," Status: 200"]}),"\n",(0,n.jsx)(t.h3,{id:"get-the-approved-signature",children:"Get the approved signature"}),"\n",(0,n.jsx)(t.admonition,{title:"Fetch Approval Task",type:"tip",children:(0,n.jsxs)(t.p,{children:["Replace the ",(0,n.jsx)(t.code,{children:"{id}"})," with the id returned in the first request, e.g. ",(0,n.jsx)(t.code,{children:"4e8731d8-0ae6-4444-8a8c-b73ab5f0ba18"})]})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"GET:"})," ",(0,n.jsx)(t.a,{href:"https://tsb-demo.cloudshsm.com/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config#/Requests/getRequestStatus_1",children:(0,n.jsx)(t.code,{children:"/v1/request/{id}"})})]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Response"})," Status: 200"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'{\n  "id": "4e8731d8-0ae6-4444-8a8c-b73ab5f0ba18",\n  "status": "EXECUTED",\n  "executionTime": "2020-06-24T08:54:47Z",\n  "approvedBy": [\n    "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArA0bxSqhL7xfvcHbKKa8wMTMsIeJfYRdIgPxp5cU9JcmV86kyfpyRcSNSi44LVeNmAi94F3OZrXXi6CZvWrFL+VcewUtUSu+kG5oLJ9T4O6R2I5GO2Ev1HJnK3WfHOsFKFxLGzmKyjEkSLGgopY+Nh74K8Q6yxsvQPETOs9TzQiUXFYlfEZnbjUWG4eAgW9WWEopmK/X295ToOuTHFzmzO00btkjAy6vwWOabCE4kaJg+bCNW1snZz84uonr60rB9H0Mj98RbTfbDyMh6cIkaj8WrXeaYh4fxQYXApYu3nzhe3Q1bNCzV5M68rCsgVrmWcK/xUhM9BK6QHSwS/l76wIDAQAB"\n  ],\n  "notYetApprovedBy": [],\n  "rejectedBy": [],\n  "result": "H3bq8PdgSiAlhB0kt1RSD6a3JYXZoj/dz3Nb/MHlgISnmh6x3TPtnV+9mUnw8PV2Ss1pq8txdMOBg9SF8uaKyUvFtLl/QFHIgllm/Q/uvrjaM205Cdz1uaSLePXaNXeC012l1sqlhnyqGKxKTKejMngzNHAnOpwU7kGCEpKPFWL5ltaBRYd3Q/I/F9IufAsKHj+3ky/p6tYN5VPhJSKiSE2YuVyOzGPHY40ipVo/7deBtUUjZmaZAgVQNC1mC79LOhIHLj8Ce4i41CbFZA+ZSMe+nx5bP/7uPA+kbGAjvNS3KLOFeZJ2OJCkTuThsXVh7rTp9tVqYqHU1LZm8f9bYA=="\n}\n'})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(o,{icon:"fa-solid fa-triangle-exclamation",size:"lg"})," If the quorum has been filled the request status is ",(0,n.jsx)(t.code,{children:"EXECUTED"})," and the ",(0,n.jsx)(t.code,{children:"result"})," contains the actual signature ",(0,n.jsx)(o,{icon:"fa-solid fa-triangle-exclamation",size:"lg"})]}),"\n",(0,n.jsxs)(r,{children:[(0,n.jsx)("summary",{children:"Response Parameters"}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Parameter"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"id"})}),(0,n.jsx)(t.td,{children:"Id of the task for which the approval is being submitted."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"status"})}),(0,n.jsxs)(t.td,{children:["The current status of the request. ",(0,n.jsx)(t.code,{children:"PENDING, APPROVED, EXECUTED, FAILED, EXPIRED, REJECTED, CANCELLED"})]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"executionTime"})}),(0,n.jsx)(t.td,{children:"Date and time when the request is sent to the hsm in ISO-8601 format."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"approvedBy"})}),(0,n.jsx)(t.td,{children:"Public keys of approvers that have approved the request."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"notYetApprovedBy"})}),(0,n.jsx)(t.td,{children:"Public keys of approvers that have not yet approved the request but still could approve."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"rejectedBy"})}),(0,n.jsx)(t.td,{children:"Public keys from approvers that have rejected to approve the request (i.e. they deleted the task related to this request."})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:(0,n.jsx)(t.strong,{children:"result"})}),(0,n.jsx)(t.td,{children:"The result of the request after the request was executed on the hsm. In case of a sign request this field contains the signature. In case of a decrypt request it contains the decrypted payload. Otherwise this field is empty."})]})]})]})]}),"\n",(0,n.jsx)(t.h1,{id:"whats-next",children:"What's next?"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/tsb/Tutorials/TransactionSecurityBroker/samples/multi-authorization-samples",children:"Try out other Multi Authorization Requests"})}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}function g(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},65537:(e,t,s)=>{s.d(t,{A:()=>T});var r=s(96540),n=s(34164),i=s(65627),a=s(56347),l=s(50372),o=s(30604),d=s(11861),c=s(78749);function h(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:t,children:s}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return h(e).map((e=>{let{props:{value:t,label:s,attributes:r,default:n}}=e;return{value:t,label:s,attributes:r,default:n}}))}(s);return function(e){const t=(0,d.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,s])}function p(e){let{value:t,tabValues:s}=e;return s.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:s}=e;const n=(0,a.W6)(),i=function(e){let{queryString:t=!1,groupId:s}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:t,groupId:s});return[(0,o.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(n.location.search);t.set(i,e),n.replace({...n.location,search:t.toString()})}),[i,n])]}function A(e){const{defaultValue:t,queryString:s=!1,groupId:n}=e,i=u(e),[a,o]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:s}=e;if(0===s.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:s}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${s.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=s.find((e=>e.default))??s[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:i}))),[d,h]=g({queryString:s,groupId:n}),[A,x]=function(e){let{groupId:t}=e;const s=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,i]=(0,c.Dv)(s);return[n,(0,r.useCallback)((e=>{s&&i.set(e)}),[s,i])]}({groupId:n}),j=(()=>{const e=d??A;return p({value:e,tabValues:i})?e:null})();(0,l.A)((()=>{j&&o(j)}),[j]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);o(e),h(e),x(e)}),[h,x,i]),tabValues:i}}var x=s(9136);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var m=s(74848);function b(e){let{className:t,block:s,selectedValue:r,selectValue:a,tabValues:l}=e;const o=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.a_)(),c=e=>{const t=e.currentTarget,s=o.indexOf(t),n=l[s].value;n!==r&&(d(t),a(n))},h=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const s=o.indexOf(e.currentTarget)+1;t=o[s]??o[0];break}case"ArrowLeft":{const s=o.indexOf(e.currentTarget)-1;t=o[s]??o[o.length-1];break}}t?.focus()};return(0,m.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.A)("tabs",{"tabs--block":s},t),children:l.map((e=>{let{value:t,label:s,attributes:i}=e;return(0,m.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>{o.push(e)},onKeyDown:h,onClick:c,...i,className:(0,n.A)("tabs__item",j.tabItem,i?.className,{"tabs__item--active":r===t}),children:s??t},t)}))})}function f(e){let{lazy:t,children:s,selectedValue:i}=e;const a=(Array.isArray(s)?s:[s]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===i));return e?(0,r.cloneElement)(e,{className:(0,n.A)("margin-top--md",e.props.className)}):null}return(0,m.jsx)("div",{className:"margin-top--md",children:a.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==i})))})}function v(e){const t=A(e);return(0,m.jsxs)("div",{className:(0,n.A)("tabs-container",j.tabList),children:[(0,m.jsx)(b,{...t,...e}),(0,m.jsx)(f,{...t,...e})]})}function T(e){const t=(0,x.A)();return(0,m.jsx)(v,{...e,children:h(e.children)},String(t))}},79329:(e,t,s)=>{s.d(t,{A:()=>a});s(96540);var r=s(34164);const n={tabItem:"tabItem_Ymn6"};var i=s(74848);function a(e){let{children:t,hidden:s,className:a}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(n.tabItem,a),hidden:s,children:t})}}}]);