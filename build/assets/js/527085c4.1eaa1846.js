"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[3439],{28453:(e,r,t)=>{t.d(r,{R:()=>i,x:()=>o});var a=t(96540);const n={},s=a.createContext(n);function i(e){const r=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),a.createElement(s.Provider,{value:r},e.children)}},39942:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"Tutorials/byok-key-material","title":"Salesforce - Generate and Wrap BYOK Key Material","description":"Description overview","source":"@site/salesforce-byok/Tutorials/byok-key-material.md","sourceDirName":"Tutorials","slug":"/Tutorials/byok-key-material","permalink":"/salesforce-byok/Tutorials/byok-key-material","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Salesforce - Generate and Wrap BYOK Key Material","sidebar_label":"Generate and Wrap BYOK Key Material","description":"Description overview","keywords":["hsm","cloud hsm"]},"sidebar":"tutorialSidebar","previous":{"title":"Generate a certificate","permalink":"/salesforce-byok/Tutorials/salesforce-byok-certificate"},"next":{"title":"Import BYOK Key Material","permalink":"/salesforce-byok/Tutorials/upload-byok-tenant-secret"}}');var n=t(74848),s=t(28453);const i={sidebar_position:1,title:"Salesforce - Generate and Wrap BYOK Key Material",sidebar_label:"Generate and Wrap BYOK Key Material",description:"Description overview",keywords:["hsm","cloud hsm"]},o="Generate and Wrap BYOK Key Material",c={},l=[{value:"Convert Salesforce Certificate",id:"convert-salesforce-certificate",level:2},{value:"Create Tenant Secret Key",id:"create-tenant-secret-key",level:2},{value:"Export and Wrap the BYOK Key Material",id:"export-and-wrap-the-byok-key-material",level:2}];function d(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"generate-and-wrap-byok-key-material",children:"Generate and Wrap BYOK Key Material"})}),"\n",(0,n.jsx)(r.p,{children:"Before exporting and wrapping the BYOK key material, some interim steps must be made."}),"\n",(0,n.jsx)(r.h2,{id:"convert-salesforce-certificate",children:"Convert Salesforce Certificate"}),"\n",(0,n.jsxs)(r.p,{children:["The Primus Tools ",(0,n.jsx)(r.code,{children:"SalesforceByokExport"})," command currently allows for either ",(0,n.jsx)(r.code,{children:".der"})," or ",(0,n.jsx)(r.code,{children:".pem"})," formats, therefore a conversion of the Salesforce BYOK-compatible certificate file must be done.\nConvert the ",(0,n.jsx)(r.code,{children:".crt"})," file, downloaded from Salesforce, to ",(0,n.jsx)(r.code,{children:".pem"})," format. There are different tools that allow this conversion."]}),"\n",(0,n.jsxs)(r.p,{children:["In our example the conversion is done with the ",(0,n.jsx)(r.a,{href:"https://www.openssl.org/",children:"OpenSSL library"}),". For more information on OpenSSL, please refer to ",(0,n.jsx)(r.a,{href:"https://www.openssl.org/docs/",children:"OpenSSL documentation"}),"."]}),"\n",(0,n.jsxs)(r.p,{children:["With the library installed, use OpenSSL to change the certificate from ",(0,n.jsx)(r.code,{children:".crt"})," to ",(0,n.jsx)(r.code,{children:".pem"})," format."]}),"\n",(0,n.jsx)(r.p,{children:"Example:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"openssl x509 -in BYOK1.crt -out BYOK1.pem\n"})}),"\n",(0,n.jsx)(r.h2,{id:"create-tenant-secret-key",children:"Create Tenant Secret Key"}),"\n",(0,n.jsxs)(r.p,{children:["The tenant secret key is used as a base key from which the BYOK key material is derived. This tenant secret will be encrypted by the public key from the BYOK-compatible certificate downloaded in chapter ",(0,n.jsx)(r.a,{href:"/salesforce-byok/Tutorials/salesforce-byok-certificate",children:"Generate Salesforce BYOK-Compatible Certificate"}),". To create the tenant secret key the ",(0,n.jsx)(r.code,{children:"CreateKey"})," Primus Tools command can be used. Skip this step if you already have a key prepared with the required parameters."]}),"\n",(0,n.jsxs)(r.p,{children:["Create an HMAC key with ",(0,n.jsx)(r.a,{href:"../../primus-tools/overview",children:"Primus Tools"}),". CreateKey command:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"java -jar primus-tools.jar CreateKey <HSM connection and credentials> -keyname SalesforceHMAC -type HMACSHA256\n"})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Make sure to replace the ",(0,n.jsx)(r.code,{children:"<HSM connection and credentials>"})," parameter. See ",(0,n.jsx)(r.a,{href:"/primus-tools/Installation/Provider",children:"HSM Connection and Access Credentials"})," for more details."]}),"\n",(0,n.jsxs)(r.li,{children:["See ",(0,n.jsx)(r.a,{href:"../../connectivity-details/overview",children:"Connectivity Details"})," for general connection parameters required for either ",(0,n.jsx)(r.a,{href:"../../cloudhsm/overview",children:"CloudHSM"})," or on-premises Primus HSM."]}),"\n",(0,n.jsxs)(r.li,{children:["With ",(0,n.jsx)(r.code,{children:"-keyname"})," specify the name of the tenant key."]}),"\n",(0,n.jsxs)(r.li,{children:["Keep the ",(0,n.jsx)(r.code,{children:"-type"})," parameter set to ",(0,n.jsx)(r.code,{children:"HMACSHA256"})," as it is required for the Salesforce BYOK procedure."]}),"\n"]}),"\n",(0,n.jsx)(r.admonition,{type:"note",children:(0,n.jsxs)(r.p,{children:["For more information on the ",(0,n.jsx)(r.code,{children:"CreateKey"})," command, see ",(0,n.jsx)(r.a,{href:"../../primus-tools/Tutorials/command-details/object-management#create-key",children:"Primus Tools - Create Key"}),"."]})}),"\n",(0,n.jsx)(r.admonition,{type:"note",children:(0,n.jsx)(r.p,{children:"Other API tools can be used to create this key. Refer to their respective guides on how to do so."})}),"\n",(0,n.jsx)(r.h2,{id:"export-and-wrap-the-byok-key-material",children:"Export and Wrap the BYOK Key Material"}),"\n",(0,n.jsxs)(r.p,{children:["The Primus Tools ",(0,n.jsx)(r.code,{children:"SalesforceByokExport"})," command uses the Salesforce BYOK-compatible certificate public key to wrap a temporary extracted AES key, derived from the tenant secret key and a derivation string."]}),"\n",(0,n.jsxs)(r.p,{children:["Example use of the ",(0,n.jsx)(r.code,{children:"SalesforceByokExport"})," command:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"java -jar primus-tools.jar SalesforceByokExport <HSM connection and credentials> -kekfile BYOK1.pem -hmackey SalesforceHMAC -derivation key8 -shaOnHsm -outfile BYOK\n"})}),"\n",(0,n.jsx)(r.p,{children:"Where:"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"-kekfile"}),", specify the converted Salesforce BYOK-compatible certificate file, see ",(0,n.jsx)(r.a,{href:"#convert-salesforce-certificate",children:"Convert Salesforce Certificate"}),"."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"-hmackey"}),", specify the name of the tenant secret key (HMAC key), see ",(0,n.jsx)(r.a,{href:"#create-tenant-secret-key",children:"Create Tenant Secret Key"})]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"-derivation"}),", specifiy the derivation string, this can be a random string (recommended to note down, in case the same BYOK Key Material must be exported again)"]}),"\n",(0,n.jsxs)(r.li,{children:["Use the ",(0,n.jsx)(r.code,{children:"-shaOnHSM"})," parameter to calculate the SHA-256 on the HSM (requires a primusX.jar version 2.4.2 or later)."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.code,{children:"outfile"}),", specify the file name for the exported and wrapped BYOK key material."]}),"\n",(0,n.jsxs)(r.li,{children:["For Salesforce CA signed BYOK certificate, validate certificate chain with ",(0,n.jsx)(r.code,{children:"-validate"})," parameter"]}),"\n"]}),"\n",(0,n.jsx)(r.admonition,{type:"note",children:(0,n.jsxs)(r.p,{children:["For more information about the command and the procedure, see ",(0,n.jsx)(r.a,{href:"../../primus-tools/Tutorials/command-details/Bring-Your-Own-Key",children:"Primus Tools - Bring Your Own Key"}),"."]})}),"\n",(0,n.jsxs)(r.p,{children:["After a successful ",(0,n.jsx)(r.code,{children:"SalesforceByokExport"})," command, 2 exported files are created. Both files are encoded in base64. In our example these files are ",(0,n.jsx)(r.code,{children:"BYOK.b64"})," the wrapped tenant secret and ",(0,n.jsx)(r.code,{children:"BYOK_hash.b64"})," the hashed tenant secret. They will be needed to import the tenant secret into Salesforce."]}),"\n",(0,n.jsxs)(r.admonition,{title:"need help ?",type:"tip",children:[(0,n.jsx)(r.p,{children:"Contact our support team for further assistance."}),(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://support.securosys.com",children:"Create a ticket (account required)"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"mailto:support@securosys.com",children:"Send an email"})}),"\n"]})]})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}}}]);