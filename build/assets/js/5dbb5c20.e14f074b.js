"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[38410],{28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var r=n(96540);const i={},s=r.createContext(i);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:t},e.children)}},53441:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>f,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Installation/Installation-Overview","title":"Generating Certificate for Microsoft IIS","description":"Generating and Installing Certificate for Microsoft Internet Information Services (IIS) & Securosys Hardware Security Modules.","source":"@site/ms-iis/Installation/Installation-Overview.md","sourceDirName":"Installation","slug":"/Installation/Installation-Overview","permalink":"/ms-iis/Installation/Installation-Overview","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Generating Certificate for Microsoft IIS","sidebar_label":"3. Generate Certificate","description":"Generating and Installing Certificate for Microsoft Internet Information Services (IIS) & Securosys Hardware Security Modules.","keywords":["hsm clusters","primus hsm","microsoft","iis","securosys"]},"sidebar":"tutorialSidebar","previous":{"title":"2. Installing CNG Provider","permalink":"/ms-iis/Installation/Provider-Setup"},"next":{"title":"Tutorial","permalink":"/ms-iis/category/tutorial"}}');var i=n(74848),s=n(28453),a=n(65537),l=n(79329);const o={sidebar_position:2,title:"Generating Certificate for Microsoft IIS",sidebar_label:"3. Generate Certificate",description:"Generating and Installing Certificate for Microsoft Internet Information Services (IIS) & Securosys Hardware Security Modules.",keywords:["hsm clusters","primus hsm","microsoft","iis","securosys"]},c="IIS Generating and Installing Certificate",u={},d=[{value:"Generating Certificate",id:"generating-certificate",level:2},{value:"Prepare Certificate Signing Request File",id:"prepare-certificate-signing-request-file",level:3},{value:"Installing CA Signed Web Server Certificate",id:"installing-ca-signed-web-server-certificate",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"iis-generating-and-installing-certificate",children:"IIS Generating and Installing Certificate"})}),"\n",(0,i.jsx)(t.admonition,{type:"note",children:(0,i.jsxs)(t.p,{children:["This guide assumes that you are familiar with the ",(0,i.jsx)(t.strong,{children:"Primus HSM"}),", the ",(0,i.jsx)(t.strong,{children:"Microsoft Internet Information Services"})," and certificates. For the sake of simplicity only the domain administrator role is used instead of the IIS management roles defined by Microsoft."]})}),"\n",(0,i.jsx)(t.p,{children:"This procedure provides a straightforward integration process, which has been tested. Please take notice that there may be other ways to achieve interoperability."}),"\n",(0,i.jsx)(t.h2,{id:"generating-certificate",children:"Generating Certificate"}),"\n",(0,i.jsxs)(t.p,{children:["As the IIS 10 Manager does not yet support creation of certificates protected by CNG keys on the graphical user interface, these keys and certificates need to be created using the command line utility ",(0,i.jsx)(t.code,{children:"certreq.exe"})]}),"\n",(0,i.jsxs)(t.p,{children:["There are different approaches to the cert generation, depending on the used ",(0,i.jsx)(t.em,{children:"Certification Authority"})," (CA) (e.g. MS ADCS) and the validity of range of the certificates (internal or public). The page below differentiates between the following two scenario:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["using the internal available ",(0,i.jsx)(t.a,{href:"/ms-pki-adcs/Tutorials/Standalone-Root-Ca/Setup-Overview",children:"Microsoft ADCS"})," documentation (ADCS, requires template definitions)"]}),"\n",(0,i.jsx)(t.li,{children:"using a public certificate, signed by an official public CA."}),"\n"]}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsxs)(t.p,{children:["This page will go over all the necessary requirements of creating a certificate using ",(0,i.jsx)(t.strong,{children:"MS ADCS"})," or a ",(0,i.jsx)(t.strong,{children:"public certificate"})," signed by a trusted public CA."]})}),"\n",(0,i.jsx)(t.h3,{id:"prepare-certificate-signing-request-file",children:"Prepare Certificate Signing Request File"}),"\n",(0,i.jsxs)(t.p,{children:["To generate a request for an SSL certificate linked to the appropriate private key stored on the Primus HSM, create and prepare the input file for the ",(0,i.jsx)(t.code,{children:"certreq.exe"})," tool."]}),"\n",(0,i.jsxs)(t.p,{children:["The sample ",(0,i.jsx)(t.code,{children:".inf"})," request file below is intended to issue a certificate for a secure web server, serving ",(0,i.jsx)(t.code,{children:"https://test.demo-iss.hsmdemo.test"}),"."]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Click to reveal sample config"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'[Version]\nSignature= "$Windows NT$"\n\n[NewRequest]\nSubject = "CN=iis-hsm-demo.securosys,O=hsmdemo,OU=IT,L=Zurich,S=ZH,C=CH"\nFriendlyName = "IIS Demo Certificate on Primus HSM"\nMachineKeySet = True\nExportable = FALSE\nHashAlgorithm = SHA256\nKeyAlgorithm = RSA\nKeyLength = 4096\nKeyUsage = 0xa0\nProviderName = "Securosys Primus HSM Key Storage Provider"\nKeyContainer = "iisdemokey"\n;RequestType = PKCS10\n;ValidityPeriod = Years\n;ValidityPeriodUnits = 1\n\n[EnhancedKeyUsageExtension]\nOID=1.3.6.1.5.5.7.3.1\n\n[RequestAttributes]\nCertificateTemplateName = WebServerHSM3\n'})})]}),"\n",(0,i.jsx)(t.p,{children:"Update the following values:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Subject"}),", replace with your real data"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"KeyContainer"})," - define your key container ID (visible key name on the HSM) or remove the line for default values"]}),"\n",(0,i.jsx)(t.li,{children:"Adapt the algorithms according to your requirements"}),"\n",(0,i.jsx)(t.li,{children:"Define additional extensions if required"}),"\n"]}),"\n",(0,i.jsxs)(a.A,{children:[(0,i.jsxs)(l.A,{value:"ui",label:"MS ADCS",default:!0,children:[(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Adapt the ",(0,i.jsx)(t.code,{children:"iis-certrequest.inf"})," file","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["comment-out or delete the line ",(0,i.jsx)(t.code,{children:";RequestType = PKCS10"})]}),"\n",(0,i.jsxs)(t.li,{children:["add the section ",(0,i.jsx)(t.code,{children:"[RequestAttributes]"})," and the line ",(0,i.jsx)(t.code,{children:"CertificateTemplateName = WebServerHSM3"})," (you can create your own template, for more information, please follow ",(0,i.jsx)(t.a,{href:"/ms-pki-adcs/Tutorials/Deploying-cert-template#modifying-the-certificate-request-templates",children:"Modifying the Certificate Request Templates"})," page)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.li,{children:"Generate the Certificate Signing Request (CSR) to be signed by the MS ADCS SubCA"}),"\n"]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-powershell",children:"certreq.exe \u2013new iis-certrequest.inf iis-certrequest.req\nCertReq: Request Created\n"})}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Submit the certificate signing request to the MS SubCA with the following command"}),"\n"]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-powershell",children:"certreq.exe -submit -attrib \u201cCertificateTemplate:WebServerHSM3\u201d iis-certrequest.req\nActive Directory Enrollment Policy\n {5DA464A9-C243-4515-BA8D-7137CFEC7B17}\n ldap:\nRequestId: 42\n"})})]}),(0,i.jsxs)(l.A,{value:"pub",label:"Public CA",children:[(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Adapt the ",(0,i.jsx)(t.code,{children:"iis-certrequest.inf"})," file","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["uncomment/add the line ",(0,i.jsx)(t.code,{children:"RequestType = PKCS10"})]}),"\n",(0,i.jsxs)(t.li,{children:["comment-out/delete the line with ",(0,i.jsx)(t.code,{children:"CertificateTemplateName = WebServerHSM3"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.li,{children:"Generate the Certificate Signing Request (CSR) to be signed by a public certification authority:"}),"\n"]}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-powershell",children:"certreq.exe -new iis-certrequest.inf iis-certrequest.csr\n"})}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Sign the resulting CSR file using your public certification authority of choice"}),"\n"]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"installing-ca-signed-web-server-certificate",children:"Installing CA Signed Web Server Certificate"}),"\n",(0,i.jsx)(t.p,{children:"Once you have the singed certificate, install it on machine level context by running"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-powershell",children:"certreq.exe \u2013accept -machine <certificateFilename.cer>\n"})}),"\n",(0,i.jsx)(t.p,{children:"This makes the new certificate visible to all applications on the server and can therefore be used by multiple users/applications running on it."})]})}function f(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},65537:(e,t,n)=>{n.d(t,{A:()=>S});var r=n(96540),i=n(34164),s=n(65627),a=n(56347),l=n(50372),o=n(30604),c=n(11861),u=n(78749);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:i}}=e;return{value:t,label:n,attributes:r,default:i}}))}(n);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function f(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function p(e){let{queryString:t=!1,groupId:n}=e;const i=(0,a.W6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,o.aZ)(s),(0,r.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(i.location.search);t.set(s,e),i.replace({...i.location,search:t.toString()})}),[s,i])]}function m(e){const{defaultValue:t,queryString:n=!1,groupId:i}=e,s=h(e),[a,o]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!f({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:s}))),[c,d]=p({queryString:n,groupId:i}),[m,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[i,s]=(0,u.Dv)(n);return[i,(0,r.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:i}),b=(()=>{const e=c??m;return f({value:e,tabValues:s})?e:null})();(0,l.A)((()=>{b&&o(b)}),[b]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!f({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),g(e)}),[d,g,s]),tabValues:s}}var g=n(9136);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=n(74848);function v(e){let{className:t,block:n,selectedValue:r,selectValue:a,tabValues:l}=e;const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),u=e=>{const t=e.currentTarget,n=o.indexOf(t),i=l[n].value;i!==r&&(c(t),a(i))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=o.indexOf(e.currentTarget)+1;t=o[n]??o[0];break}case"ArrowLeft":{const n=o.indexOf(e.currentTarget)-1;t=o[n]??o[o.length-1];break}}t?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},t),children:l.map((e=>{let{value:t,label:n,attributes:s}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>{o.push(e)},onKeyDown:d,onClick:u,...s,className:(0,i.A)("tabs__item",b.tabItem,s?.className,{"tabs__item--active":r===t}),children:n??t},t)}))})}function y(e){let{lazy:t,children:n,selectedValue:s}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:a.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function j(e){const t=m(e);return(0,x.jsxs)("div",{className:(0,i.A)("tabs-container",b.tabList),children:[(0,x.jsx)(v,{...t,...e}),(0,x.jsx)(y,{...t,...e})]})}function S(e){const t=(0,g.A)();return(0,x.jsx)(j,{...e,children:d(e.children)},String(t))}},79329:(e,t,n)=>{n.d(t,{A:()=>a});n(96540);var r=n(34164);const i={tabItem:"tabItem_Ymn6"};var s=n(74848);function a(e){let{children:t,hidden:n,className:a}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(i.tabItem,a),hidden:n,children:t})}}}]);