"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[69278],{28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var s=n(96540);const r={},a=s.createContext(r);function i(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:t},e.children)}},83276:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"Tutorials/Migrating-MPKI-to-HSM/Backup-ADCS","title":"Backing up Microsoft AD CS database","description":"Backing up Microsoft AD CS database for Securosys Hardware Security Modules (HSMs)","source":"@site/ms-pki-adcs/Tutorials/Migrating-MPKI-to-HSM/Backup-ADCS.md","sourceDirName":"Tutorials/Migrating-MPKI-to-HSM","slug":"/Tutorials/Migrating-MPKI-to-HSM/Backup-ADCS","permalink":"/ms-pki-adcs/Tutorials/Migrating-MPKI-to-HSM/Backup-ADCS","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Backing up Microsoft AD CS database","sidebar_label":"Backup","description":"Backing up Microsoft AD CS database for Securosys Hardware Security Modules (HSMs)","keywords":["hsm","cloud hsm"]},"sidebar":"tutorialSidebar","previous":{"title":"Overview","permalink":"/ms-pki-adcs/Tutorials/Migrating-MPKI-to-HSM/Migrating-MPKI-toHSM"},"next":{"title":"Delete Key/Certificate","permalink":"/ms-pki-adcs/Tutorials/Migrating-MPKI-to-HSM/Delete-Key&Cert"}}');var r=n(74848),a=n(28453);const i={sidebar_position:1,title:"Backing up Microsoft AD CS database",sidebar_label:"Backup",description:"Backing up Microsoft AD CS database for Securosys Hardware Security Modules (HSMs)",keywords:["hsm","cloud hsm"]},o="Backing up Microsoft AD CS database",c={},l=[];function d(e){const t={code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"backing-up-microsoft-ad-cs-database",children:"Backing up Microsoft AD CS database"})}),"\n",(0,r.jsx)(t.p,{children:"It is recommended to create a backup of the AD CS database, registry settings and the AD CS certificate including the private key (if exportable)."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Open a Command Shell with administrator rights"}),"\n",(0,r.jsx)(t.li,{children:"Check that AD CS is alive (and note the CA name)"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'certutil -ping\n\nConnecting to WIN-E99A37QE5JP\\myDemoCA ...\nServer "myDemoCA" ICertRequest2 interface is alive (15ms)\nCertUtil: -ping command completed successfully.\n'})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Backup AD CS database, logs and private key on command line using"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"certutil -backup <myBackupFolder>.[KeepLog] \n\nEnter a secure password to protect the PKCS#12 file.\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"certutil -backup myDemoCA\n\nEnter new password:\nConfirm new password:\nBacked up keys and certificates for WIN-E99A37QE5JP\\myDemoCA to myDemoCA\\myDemoCA.p12.\nFull database backup for WIN-E99A37QE5JP\\myDemoCA.\nBacking up Database files: 100%\nBacking up Log files: 100%\nTruncating Logs: 100%\nBacked up database to myDemoCA.\nDatabase logs successfully truncated.\nCertUtil: -backup command completed successfully.\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Backup the AD CS registry settings:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"reg export HKLM\\SYSTEM\\CurrentControlSet\\services\\CertSvc myDemoCA\\myCAregistry.reg\n\nThe operation completed successfully.\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Get configuration part of the AD CS CSP configuration to modify later:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"reg export HKLM\\SYSTEM\\CurrentControlSet\\services\\CertSvc\\Configuration\\myDemoCA\\CSP myDemoCA\\myCACSPregistry.reg\n\nThe operation completed successfully.\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Get configuration part of the AD CS EncryptionCSP to modify later:"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"reg export HKLM\\SYSTEM\\CurrentControlSet\\services\\CertSvc\\Configuration\\myDemoCA\\EncryptionCSP myDemoCA\\myCAEncryptionCSPregistry.reg\n\nThe operation completed successfully.\n"})})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);