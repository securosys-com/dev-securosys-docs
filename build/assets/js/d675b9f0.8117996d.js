"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[32972],{28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>i});var r=n(96540);const o={},s=r.createContext(o);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:t},e.children)}},40309:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"Tutorials/Create-KMS-key","title":"AWS BYOK - How to create a key for AWS KMS","description":"By default, AWS KMS creates key material when you create an AWS KMS key. To import your own key material instead, create a KMS key without key material. Then import the key material. To create a KMS key with no key material, it is possible to use the AWS Management Console or the create-key request with AWS KMS API.","source":"@site/aws-byok/Tutorials/Create-KMS-key.md","sourceDirName":"Tutorials","slug":"/Tutorials/Create-KMS-key","permalink":"/aws-byok/Tutorials/Create-KMS-key","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"AWS BYOK - How to create a key for AWS KMS","sidebar_label":"Create Key on HSM"},"sidebar":"tutorialSidebar","previous":{"title":"Tutorial","permalink":"/aws-byok/category/tutorial"},"next":{"title":"Downloading Public Key & Import Token","permalink":"/aws-byok/Tutorials/Download-Pub-key"}}');var o=n(74848),s=n(28453),a=n(65537),i=n(79329);const l={sidebar_position:3,title:"AWS BYOK - How to create a key for AWS KMS",sidebar_label:"Create Key on HSM"},c="Create AWS KMS Key",d={},h=[];function u(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"create-aws-kms-key",children:"Create AWS KMS Key"})}),"\n",(0,o.jsx)(t.p,{children:"By default, AWS KMS creates key material when you create an AWS KMS key. To import your own key material instead, create a KMS key without key material. Then import the key material. To create a KMS key with no key material, it is possible to use the AWS Management Console or the create-key request with AWS KMS API."}),"\n",(0,o.jsxs)(t.p,{children:["To create a key with no key material, specify a key spec of ",(0,o.jsx)(t.code,{children:"SYMMETRIC_DEFAULT"})," (the default value) and an origin of ",(0,o.jsx)(t.code,{children:"EXTERNAL"}),". The key spec and origin of a KMS key are immutable values."]}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"Once you create a key designed for imported key material in KMS, it is not possible to convert it into a KMS key with key material from AWS KMS or any other source!"})}),"\n",(0,o.jsxs)(t.p,{children:["The key state of a KMS key with an ",(0,o.jsx)(t.code,{children:"EXTERNAL"})," origin and no key material is ",(0,o.jsx)(t.code,{children:"PendingImport"}),". A KMS key can remain in ",(0,o.jsx)(t.code,{children:"PendingImport"})," state indefinitely. However, it is not possible to use a KMS key in ",(0,o.jsx)(t.code,{children:"PendingImport"})," state in cryptographic operations. When key material is imported, the key state of the KMS key changes to Enabled, and is ready to use in cryptographic operations."]}),"\n",(0,o.jsx)(t.p,{children:"AWS KMS records an entry in the AWS CloudTrail log when creating a KMS key, downloading the public key and import token, as well as importing the key material. AWS KMS also records an entry when you delete imported key material or when AWS KMS deletes expired key material."}),"\n",(0,o.jsxs)(t.p,{children:["For information about creating multi-Region keys with imported key material, see ",(0,o.jsx)(t.a,{href:"https://docs.aws.amazon.com/kms/latest/developerguide/multi-region-keys-import.html",children:"Importing key material into multi-Region keys"}),"."]}),"\n",(0,o.jsxs)(a.A,{groupId:"device-setup",children:[(0,o.jsxs)(i.A,{value:"ui",label:"Create KMS key (via AWS Console)",default:!0,children:[(0,o.jsxs)(t.p,{children:["Use the AWS Management Console to create a symmetric encryption KMS key without key material. Imported keys have an Origin value of ",(0,o.jsx)(t.code,{children:"External"}),". It is necessary to create a KMS key for the imported key material only once and reimport the same key material into an existing KMS key."]}),(0,o.jsx)(t.p,{children:"Please follow the next steps to create a KMS key with no key material."}),(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Sign in to the AWS Management Console and open the AWS Key Management Service (AWS KMS) console."}),"\n",(0,o.jsx)(t.li,{children:"To change the AWS Region, use the Region selector in the upper-right corner of the page."}),"\n",(0,o.jsxs)(t.li,{children:["In the navigation pane, choose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Customer managed keys"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Choose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Create key"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Choose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Symmetric"})}),"."]}),"\n"]}),(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"It is not possible to import key material into an asymmetric KMS key."})}),(0,o.jsxs)(t.ol,{start:"6",children:["\n",(0,o.jsxs)(t.li,{children:["In ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Key usage"})}),", the ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Encrypt and decrypt"})})," option is already selected. Do not change it."]}),"\n"]}),(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"You cannot import key material into an HMAC KMS key."})}),(0,o.jsxs)(t.ol,{start:"7",children:["\n",(0,o.jsxs)(t.li,{children:["Expand ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Advanced options"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["For ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Key material origin"})}),", select ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"External"})}),"."]}),"\n"]}),(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"You cannot import key material into a KMS key in a custom key store."})}),(0,o.jsxs)(t.ol,{start:"9",children:["\n",(0,o.jsxs)(t.li,{children:["Confirm the check box next to ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"I understand the security, availability, and durability implications of using an imported key"})})," to indicate that you understand the implications of using imported key material."]}),"\n",(0,o.jsx)(t.li,{children:"By default, this procedure creates a KMS key in the selected Region."}),"\n"]}),(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsxs)(t.p,{children:["To create a multi-Region primary key with no key material, in the ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Regionality"})})," section, choose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Multi-Region key"})}),"."]})}),(0,o.jsxs)(t.ol,{start:"11",children:["\n",(0,o.jsxs)(t.li,{children:["Choose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Next"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Type an alias and (optionally) a description for the KMS key.\nChoose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Next"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["(Optional). On the ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Add tags"})})," page, add tags that identify or categorize the KMS key.\nChoose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Next"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["In the ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Key administrators"})})," section, select the IAM users and roles who can manage the KMS key."]}),"\n"]}),(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"IAM policies can give other IAM users and roles permission to manage the KMS key."})}),(0,o.jsxs)(t.ol,{start:"15",children:["\n",(0,o.jsxs)(t.li,{children:["(Optional) To prevent the selected IAM users and roles from deleting this KMS key, in the ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Key deletion"})})," section at the bottom of the page, clear the ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Allow key administrators to delete this key"})})," check box.\nChoose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Next"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["In the ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"This account"})})," section, select the IAM users and roles in this AWS account who can use the KMS key in crypto-graphic operations."]}),"\n"]}),(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"IAM policies can give other IAM users and roles permission to use the KMS key."})}),(0,o.jsxs)(t.ol,{start:"17",children:["\n",(0,o.jsx)(t.li,{children:"(Optional) It is possible to allow other AWS accounts to use this KMS key for cryptographic operations."}),"\n"]}),(0,o.jsxs)(t.p,{children:["To do so, in the ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Other AWS accounts"})})," section at the bottom of the page, choose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Add another AWS account"})})," and enter the AWS account ID of an external account. To add multiple external accounts, repeat this step."]}),(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"To allow principals in the external accounts to use the KMS key, Administrators of the external account must create IAM policies that provide these permissions."})}),(0,o.jsxs)(t.p,{children:["Choose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Next"})}),"."]}),(0,o.jsxs)(t.ol,{start:"18",children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Review the key settings. It is possible to return and adapt all settings before finishing."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["When done, choose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Finish"})})," to create the key."]}),"\n"]}),"\n"]}),(0,o.jsxs)(t.p,{children:["If the operation succeeds, you have created a KMS key with no key material. Its status is ",(0,o.jsx)(t.code,{children:"Pending import"}),". To con-tinue the process now, see ",(0,o.jsx)(t.a,{href:"/aws-byok/Tutorials/Download-Pub-key",children:"Downloading the public key and import token (console)"}),". To continue the process later, choose ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"Cancel"})}),"."]})]}),(0,o.jsxs)(i.A,{value:"console",label:"Create a KMS Key (via AWS KMS API)",default:!0,children:[(0,o.jsxs)(t.p,{children:["Optionally you can use the AWS KMS API to create a symmetric encryption KMS key with no key material, send a ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"create-key"})})," request with the Origin parameter set to ",(0,o.jsx)(t.code,{children:"EXTERNAL"}),". The following example shows how to do so with the AWS Command Line Interface (AWS CLI)."]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"$ aws kms create-key --origin EXTERNAL\n"})}),(0,o.jsx)(t.p,{children:"If the command was successful, an output similar to the following should be printed out:"}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:'{\n    "KeyMetadata": {\n        "Origin": "EXTERNAL",\n        "KeyId": "1234abcd-12ab-34cd-56ef-1234567890ab",\n        "Description": "",\n        "Enabled": false,\n        "MultiRegion": false,\n        "KeyUsage": "ENCRYPT_DECRYPT",\n        "KeyState": "PendingImport",\n        "CreationDate": 1568289600.0,\n        "Arn": "arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab",\n        "AWSAccountId": "111122223333",\n        "KeyManager": "CUSTOMER",\n        "KeySpec": "SYMMETRIC_DEFAULT",\n        "CustomerMasterKeySpec": "SYMMETRIC_DEFAULT",\n        "EncryptionAlgorithms": [\n            "SYMMETRIC_DEFAULT"\n        ]\n    }\n}\n'})}),(0,o.jsxs)(t.p,{children:["The AWS KMS key's Origin is seen as ",(0,o.jsx)(t.code,{children:"EXTERNAL"})," and its ",(0,o.jsx)(t.code,{children:"KeyState"})," is ",(0,o.jsx)(t.code,{children:"PendingImport"}),"."]}),(0,o.jsxs)(t.p,{children:["Ensure to copy the ",(0,o.jsx)(t.code,{children:"KeyId"})," value from your command output as it will be used in later steps of the guide."]})]})]})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},65537:(e,t,n)=>{n.d(t,{A:()=>b});var r=n(96540),o=n(34164),s=n(65627),a=n(56347),i=n(50372),l=n(30604),c=n(11861),d=n(78749);function h(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return h(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:o}}=e;return{value:t,label:n,attributes:r,default:o}}))}(n);return function(e){const t=(0,c.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function y(e){let{queryString:t=!1,groupId:n}=e;const o=(0,a.W6)(),s=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(s),(0,r.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(o.location.search);t.set(s,e),o.replace({...o.location,search:t.toString()})}),[s,o])]}function m(e){const{defaultValue:t,queryString:n=!1,groupId:o}=e,s=u(e),[a,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const r=n.find((e=>e.default))??n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:s}))),[c,h]=y({queryString:n,groupId:o}),[m,x]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[o,s]=(0,d.Dv)(n);return[o,(0,r.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:o}),j=(()=>{const e=c??m;return p({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{j&&l(j)}),[j]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),x(e)}),[h,x,s]),tabValues:s}}var x=n(9136);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=n(74848);function k(e){let{className:t,block:n,selectedValue:r,selectValue:a,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),d=e=>{const t=e.currentTarget,n=l.indexOf(t),o=i[n].value;o!==r&&(c(t),a(o))},h=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":n},t),children:i.map((e=>{let{value:t,label:n,attributes:s}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:r===t?0:-1,"aria-selected":r===t,ref:e=>{l.push(e)},onKeyDown:h,onClick:d,...s,className:(0,o.A)("tabs__item",j.tabItem,s?.className,{"tabs__item--active":r===t}),children:n??t},t)}))})}function f(e){let{lazy:t,children:n,selectedValue:s}=e;const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:a.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function S(e){const t=m(e);return(0,g.jsxs)("div",{className:(0,o.A)("tabs-container",j.tabList),children:[(0,g.jsx)(k,{...t,...e}),(0,g.jsx)(f,{...t,...e})]})}function b(e){const t=(0,x.A)();return(0,g.jsx)(S,{...e,children:h(e.children)},String(t))}},79329:(e,t,n)=>{n.d(t,{A:()=>a});n(96540);var r=n(34164);const o={tabItem:"tabItem_Ymn6"};var s=n(74848);function a(e){let{children:t,hidden:n,className:a}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(o.tabItem,a),hidden:n,children:t})}}}]);