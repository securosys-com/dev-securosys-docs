"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[75347],{28453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>d});var t=o(96540);const r={},s=t.createContext(r);function i(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(s.Provider,{value:n},e.children)}},81716:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"Installation/configuration","title":"Configuration","description":"Prerequisites to install Microsoft HGS with Securosys Hardware Security Modules (HSMs)","source":"@site/ms-hgs/Installation/configuration.md","sourceDirName":"Installation","slug":"/Installation/configuration","permalink":"/ms-hgs/Installation/configuration","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Configuration","sidebar_label":"5. HGS Configuration","description":"Prerequisites to install Microsoft HGS with Securosys Hardware Security Modules (HSMs)","keywords":["hsm","cloud hsm"]},"sidebar":"tutorialSidebar","previous":{"title":"4. Certificates","permalink":"/ms-hgs/Installation/certificate"},"next":{"title":"Concepts","permalink":"/ms-hgs/category/concepts"}}');var r=o(74848),s=o(28453);const i={sidebar_position:4,title:"Configuration",sidebar_label:"5. HGS Configuration",description:"Prerequisites to install Microsoft HGS with Securosys Hardware Security Modules (HSMs)",keywords:["hsm","cloud hsm"]},d="Configure DNS Forwarding and Domain Trust",a={},c=[];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"configure-dns-forwarding-and-domain-trust",children:"Configure DNS Forwarding and Domain Trust"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"This section aplies only for Admin-trusted attestation only."})}),"\n",(0,r.jsxs)(n.p,{children:["Use the following steps to set up the necessary DNS forwarding from the HGS domain to the ",(0,r.jsx)(n.code,{children:"control_am"})," domain, and to establish a one-way forest trust to the control_am domain. These steps allow the HGS to locate the ",(0,r.jsx)(n.code,{children:"control_am"})," domain's domain controllers and validate group membership of the ",(0,r.jsx)(n.code,{children:"Hyper-V"})," hosts."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"To configure a DNS forwarder that allows HGS to resolve resources located in the fabric (host) domain, run\nthe following command in an elevated PowerShell session."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Add-DnsServerConditionalForwarderZone -Name "control_am.com" -ReplicationScope "Forest" -MasterServers <DNSserverIP>\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"control_am.com"})," with the name of your environment fabric domain and type the IP addresses of DNS servers in the fabric domain."]}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["To create a one-way forest trust from the HGS domain to the ",(0,r.jsx)(n.code,{children:"control_am"})," domain, run the following command in an elevated PowerShell session:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"netdom trust relecloud.com /domain:control_am.com /userD:control_am.com\\Administrator /passwordD:<password> /add\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"relecloud.com"})," with the name of your environment HGS domain and ",(0,r.jsx)(n.code,{children:"control_am.com"})," with the name of your environment. fabric domain. Make sure to provide the password for and admin of the fabric domain."]}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Create a one-way forest trust from the HGS domain to the ",(0,r.jsx)(n.code,{children:"control_am"})," domain, run the following command in an elevated PowerShell session:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:"netdom trust relecloud.com /domain:control_am.com /userD:control_am.com\\Administrator /passwordD:<password> /add\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"relecloud.com"})," with the name of your environment HGS domain and ",(0,r.jsx)(n.code,{children:"control_am.com"})," with the name of your environment. fabric domain. Make sure to provide the password and admin of the fabric domain and log on to the ",(0,r.jsx)(n.code,{children:"control_am"})," domain as an administrative privileges."]}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["Open the PowerShell and add the ",(0,r.jsx)(n.code,{children:"relecloud"})," domain."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Add-DnsServerConditionalForwarderZone -Name "relecloud.com" -ReplicationScope "Forest" \u2013MasterServers <DNSserverAddress>\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'Log on to the CONTROL_AD as a domain administrator and create a Global Security group "Guarded Hosts" in the Active Directory.'}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add the ",(0,r.jsx)(n.strong,{children:"HOST_1"}),' into the created group "',(0,r.jsx)(n.strong,{children:"Guarded Hosts"}),'".']}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Restart the ",(0,r.jsx)(n.strong,{children:"HOST_1"})," machine to enable the security policies."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["On CONTROL_AD, use ",(0,r.jsx)(n.code,{children:"Get-ADGroup"})," command to obtain the security identifier (SID) of the security group and provide it to the HGS administrator."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Get-ADGroup "Guarded Hosts"\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"9",children:["\n",(0,r.jsxs)(n.li,{children:["Log on to the ",(0,r.jsx)(n.strong,{children:"HOST_GS_AD"})," as a domain administrator and open the PowerShell and run the command to add HGS Attestation group."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Add-HgsAttestationHostGroup -Name "Guarded Hosts" -Identifier "S-1-5-21-1755809051-1406045892-3533544011-1105"\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"10",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Now log on to the ",(0,r.jsx)(n.strong,{children:"HOST_1"})," as domain administrator."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If the required role is not already installed, install the ",(0,r.jsx)(n.code,{children:"Hyper-V"})," role and ",(0,r.jsx)(n.code,{children:"Host Guardian Hyper-V"})," Support feature with the following command:"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Install-WindowsFeature Hyper-V, HostGuardian -IncludeManagementTools -Restart\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"12",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Configure the host's Key Protection and Attestation URLs on ",(0,r.jsx)(n.strong,{children:"HOST_1"}),". Use the ",(0,r.jsx)(n.code,{children:"Fully Qualified Domain Name (FQDN)"})," of your HGS cluster to get the HGS Cluster ask the HGS administrator to run the ",(0,r.jsx)(n.code,{children:"Get-HgsServer"})," cmdlet on the HGS server to retrieve the URLs."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["On ",(0,r.jsx)(n.strong,{children:"HOST_1"}),", configure the Key Protection and Attestation URLs by executing the following command in\nan elevated Windows PowerShell console."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Set-HgsClientConfiguration -AttestationServerUrl 'http://<FQDN>/Attestation' -KeyProtectionServerUrl 'http://<FQDN>/KeyProtection'\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"14",children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Run the ",(0,r.jsx)(n.code,{children:"Get-HgsClientConfiguration"})," cmdlet to see the status. Ensure that ",(0,r.jsx)(n.code,{children:"IsHostGuarded"})," is ",(0,r.jsx)(n.code,{children:"True"})," and ",(0,r.jsx)(n.code,{children:"AttestationStatus"})," is ",(0,r.jsx)(n.code,{children:"Passed"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Log on to the ",(0,r.jsx)(n.strong,{children:"HOST_GS_AD"})," as a domain administrator."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Run the following command on PowerShell to confirm the status of HGS Diagnostic."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Get-HgsTrace \u2013RunDiagnostics\n"})}),"\n",(0,r.jsx)(n.p,{children:"A warning message indicates that there is an error receiving the permissions for the certificate. This error is expected for certificates backed by an HSM, meaning the integration with the Securosys Primus HSM was successful."}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["To create a shielded VM using an existing VM please see ",(0,r.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/windows-server/security/guarded-fabric-shielded-vm/guarded-fabric-and-shielded-vms-top-node",children:"Microsoft Guarded fabric and shielded VMs"}),"."]})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);