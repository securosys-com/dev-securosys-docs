"use strict";(self.webpackChunksecurosys_docs=self.webpackChunksecurosys_docs||[]).push([[49510],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var i=t(96540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}},55449:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"osslv3/Tutorial/troubleshooting","title":"Troubleshooting - PKCS#11 API for OpenSSL","description":"Discover OpenSSL\'s PKCS11 provider, CLI commands, installation tips, and troubleshooting. Integrate seamlessly with HSM for enhanced security.","source":"@site/openssl/osslv3/Tutorial/troubleshooting.md","sourceDirName":"osslv3/Tutorial","slug":"/osslv3/Tutorial/troubleshooting","permalink":"/openssl/osslv3/Tutorial/troubleshooting","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"OpenSSL","permalink":"/openssl/tags/open-ssl"},{"inline":true,"label":"PKCS#11","permalink":"/openssl/tags/pkcs-11"}],"version":"current","lastUpdatedAt":1741162132000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Troubleshooting - PKCS#11 API for OpenSSL","sidebar_label":"Troubleshooting","description":"Discover OpenSSL\'s PKCS11 provider, CLI commands, installation tips, and troubleshooting. Integrate seamlessly with HSM for enhanced security.","keywords":["OpenSSL PKCS11 provider","OpenSSL PKCS11 API","OpenSSL command line utility (CLI)","OpenSSL CLI commands","OpenSSL installation guide","OpenSSL installation troubleshooting","OpenSSL troubleshooting tips","OpenSSL certificate management","OpenSSL certificate creation","OpenSSL certificate renewal","OpenSSL configuration file","OpenSSL configuration options","OpenSSL configuration guide","OpenSSL encryption algorithms","OpenSSL decryption methods","OpenSSL digital signatures","OpenSSL SSL/TLS protocols","OpenSSL SSL/TLS configuration","OpenSSL heartbleed vulnerability","OpenSSL security updates"],"tags":["OpenSSL","PKCS#11"]},"sidebar":"openssl","previous":{"title":"OpenSSL CLI","permalink":"/openssl/osslv3/Tutorial/openssl_cli"},"next":{"title":"Download","permalink":"/openssl/osslv3/downloads"}}');var s=t(74848),o=t(28453);const r={sidebar_position:4,title:"Troubleshooting - PKCS#11 API for OpenSSL",sidebar_label:"Troubleshooting",description:"Discover OpenSSL's PKCS11 provider, CLI commands, installation tips, and troubleshooting. Integrate seamlessly with HSM for enhanced security.",keywords:["OpenSSL PKCS11 provider","OpenSSL PKCS11 API","OpenSSL command line utility (CLI)","OpenSSL CLI commands","OpenSSL installation guide","OpenSSL installation troubleshooting","OpenSSL troubleshooting tips","OpenSSL certificate management","OpenSSL certificate creation","OpenSSL certificate renewal","OpenSSL configuration file","OpenSSL configuration options","OpenSSL configuration guide","OpenSSL encryption algorithms","OpenSSL decryption methods","OpenSSL digital signatures","OpenSSL SSL/TLS protocols","OpenSSL SSL/TLS configuration","OpenSSL heartbleed vulnerability","OpenSSL security updates"],tags:["OpenSSL","PKCS#11"]},l="Troubleshooting PKCS#11 for OpenSSL",a={},c=[{value:"More resources",id:"more-resources",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"troubleshooting-pkcs11-for-openssl",children:"Troubleshooting PKCS#11 for OpenSSL"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["To verify that the provider is loaded correctly, use the command ",(0,s.jsx)(n.code,{children:"openssl list -providers"})," to list the active providers. If the OpenSSL PKCS#11 provider has been activated successfully, it should appear in the list."]}),"\n",(0,s.jsxs)(n.p,{children:["Additionally, you can check the available signature algorithms with the command ",(0,s.jsx)(n.code,{children:"openssl list -signature-algorithms"}),", which should display algorithms with ",(0,s.jsx)(n.code,{children:"@pkcs11"})," appended."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"openssl list -signature-algorithms\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"{ 1.2.840.113549.1.1.1, 2.5.8.1.1, RSA, rsaEncryption } @ default\n{ 1.2.840.10040.4.1, 1.2.840.10040.4.3, 1.3.14.3.2.12, 1.3.14.3.2.13, 1.3.14.3.2.27, DSA, DSA-old, DSA-SHA, DSA-SHA1, DSA-SHA1-old, dsaEncryption, dsaEncryption-old, dsaWithSHA, dsaWithSHA1, dsaWithSHA1-old } @ default\n{ 1.3.101.112, ED25519 } @ default\n{ 1.3.101.113, ED448 } @ default\n{ 1.2.156.10197.1.301, SM2 } @ default\nECDSA @ default\nHMAC @ default\nSIPHASH @ default\nPOLY1305 @ default\nCMAC @ default\n# highlight-next-line-tip\n{ 1.2.840.113549.1.1.1, 2.5.8.1.1, RSA, rsaEncryption } @ pkcs11\n{ 1.3.101.112, ED25519 } @ pkcs11\n{ 1.3.101.113, ED448 } @ pkcs11\nECDSA @ pkcs11\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The pkcs11-provider implements a lazy load behavior by default. At the moment we recommend to change the load behavior by setting ",(0,s.jsx)(n.code,{children:"pkcs11-module-load-behavior = early"})," in the [pkcs11_sect] section of your OpenSSL configuration file."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Check the pkcs11-provider logs. The logs can be controlled with the ",(0,s.jsx)(n.code,{children:"PKCS11_PROVIDER_DEBUG"})," environment variable. For instance ",(0,s.jsx)(n.code,{children:"PKCS11_PROVIDER_DEBUG=file:/tmp/p11prov-debug.log,level=5"})," will send the logs to ",(0,s.jsx)(n.em,{children:"/tmp/p11prov-debug.log"}),". The logs will tell you if ",(0,s.jsx)(n.code,{children:"pkcs11-module-path"})," points to a valid provider library and if the interaction with it is successful. Below, the (abbreviated) content of ",(0,s.jsx)(n.em,{children:"p11prov-debug.log"})," provider logs just after starting openssl is shown. The lines to look out for when analyzing the logs are highlighted. The table contains a brief description of the action that is related to the log entry. Don't forget to disable the logging after troubleshooting."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"right"},children:"Line-#"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"Corresponding action"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"right"},children:"1-2"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Dump of the configuration the pkcs11-provider received."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"right"},children:"4"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"Initializing of the Securosys PKCS#11 provider library."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"right"},children:"9"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"The Securosys PKCS#11 provider was successfully loaded."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"right"},children:"18-30"}),(0,s.jsxs)(n.td,{style:{textAlign:"left"},children:["Dump of the slot/token information ",(0,s.jsx)(n.strong,{children:"received from the HSM"}),"."]})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",metastring:"showLineNumbers",children:"// highlight-start\n[../../../../src/provider.c:1347] OSSL_provider_init(): Provided config params:\n[../../../../src/provider.c:1357] OSSL_provider_init(): pkcs11-module-path: /usr/local/primus/lib/libprimusP11.so\n// highlight-end\n...\n// highlight-next-line-info\n[../../../../src/interface.c:291] p11prov_module_init(): PKCS#11: Initializing the module: /usr/local/primus/lib/libprimusP11.so\n[../../../../src/interface.c:175] p11prov_interface_init(): C_GetInterface() not available. Falling back to C_GetFunctionList():  usr/local/primus/lib/libprimusP11.so: undefined symbol: C_GetInterface\n[../../../../src/interface.c:102] populate_interface(): Populating Interfaces with 'Internal defaults', version 2.20\n[../../../../src/interface.gen.c:13] p11prov_Initialize(): Calling C_Initialize\n[../../../../src/interface.gen.c:51] p11prov_GetInfo(): Calling C_GetInfo\n// highlight-next-line-info\n[../../../../src/interface.c:327] p11prov_module_init(): Module Info: ck_ver:3.0 lib: 'Securosys SA' 'PKCS#11 Library' ver:2.1\n...\n[../../../../src/interface.gen.c:468] p11prov_FindObjects(): Calling C_FindObjects\n[../../../../src/interface.gen.c:488] p11prov_FindObjectsFinal(): Calling C_FindObjectsFinal\n[../../../../src/slot.c:68] get_slot_profiles(): No profiles for slot 1\n[../../../../src/interface.gen.c:234] p11prov_CloseSession(): Calling C_CloseSession\n[../../../../src/interface.gen.c:173] p11prov_GetMechanismList(): Calling C_GetMechanismList\n[../../../../src/slot.c:100] get_slot_mechanisms(): Slot(1) mechs found: 105\n[../../../../src/interface.gen.c:173] p11prov_GetMechanismList(): Calling C_GetMechanismList\n// highlight-tip-start\nSlot Info:\n  ID: 1\n  Description:      [OPENSSL_PKCS11_INT_TEST]\n  Manufacturer ID:  [Securosys SA]\n  Flags (0x000005):\n\n    CKF_TOKEN_PRESENT         (0x000001)\n    CKF_HW_SLOT               (0x000004)\n  Hardware Version: 2.11\n  Firmware Version: 2.1\n\nToken Info:\n  Label:            [OPENSSL_PKCS11_INT_TEST]\n  Manufacturer ID:  [Securosys SA]\n  Model:            [Primus HSM]\n// highlight-tip-end\n...\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If OpenSSL still only lists the provider but no algorithms it is\npossible that the token is not set-up correctly. Have a look at the\nTroubleshooting section in the ",(0,s.jsx)(n.a,{href:"/pkcs/overview",children:"PKCS#11 Documentation"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"more-resources",children:"More resources"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/openssl/osslv3/Tutorial/openssl_cli",children:"Generate a key with OpenSSL"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"../Tutorial/troubleshooting",children:"Troubleshooting"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.openssl.org/master/",children:"OpenSSL documentation"}),"."]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);